{"version":3,"sources":["../../../node_modules/.pnpm/is-network-error%401.3.0/node_modules/is-network-error/index.js","../../../node_modules/.pnpm/p-retry%407.1.1/node_modules/p-retry/index.js"],"sourcesContent":["const objectToString = Object.prototype.toString;\n\nconst isError = value => objectToString.call(value) === '[object Error]';\n\nconst errorMessages = new Set([\n\t'network error', // Chrome\n\t'Failed to fetch', // Chrome\n\t'NetworkError when attempting to fetch resource.', // Firefox\n\t'The Internet connection appears to be offline.', // Safari 16\n\t'Network request failed', // `cross-fetch`\n\t'fetch failed', // Undici (Node.js)\n\t'terminated', // Undici (Node.js)\n\t' A network error occurred.', // Bun (WebKit)\n\t'Network connection lost', // Cloudflare Workers (fetch)\n]);\n\nexport default function isNetworkError(error) {\n\tconst isValid = error\n\t\t&& isError(error)\n\t\t&& error.name === 'TypeError'\n\t\t&& typeof error.message === 'string';\n\n\tif (!isValid) {\n\t\treturn false;\n\t}\n\n\tconst {message, stack} = error;\n\n\t// Safari 17+ has generic message but no stack for network errors\n\tif (message === 'Load failed') {\n\t\treturn stack === undefined\n\t\t\t// Sentry adds its own stack trace to the fetch error, so also check for that\n\t\t\t|| '__sentry_captured__' in error;\n\t}\n\n\t// Deno network errors start with specific text\n\tif (message.startsWith('error sending request for url')) {\n\t\treturn true;\n\t}\n\n\t// Standard network error messages\n\treturn errorMessages.has(message);\n}\n","import isNetworkError from 'is-network-error';\n\nfunction validateRetries(retries) {\n\tif (typeof retries === 'number') {\n\t\tif (retries < 0) {\n\t\t\tthrow new TypeError('Expected `retries` to be a non-negative number.');\n\t\t}\n\n\t\tif (Number.isNaN(retries)) {\n\t\t\tthrow new TypeError('Expected `retries` to be a valid number or Infinity, got NaN.');\n\t\t}\n\t} else if (retries !== undefined) {\n\t\tthrow new TypeError('Expected `retries` to be a number or Infinity.');\n\t}\n}\n\nfunction validateNumberOption(name, value, {min = 0, allowInfinity = false} = {}) {\n\tif (value === undefined) {\n\t\treturn;\n\t}\n\n\tif (typeof value !== 'number' || Number.isNaN(value)) {\n\t\tthrow new TypeError(`Expected \\`${name}\\` to be a number${allowInfinity ? ' or Infinity' : ''}.`);\n\t}\n\n\tif (!allowInfinity && !Number.isFinite(value)) {\n\t\tthrow new TypeError(`Expected \\`${name}\\` to be a finite number.`);\n\t}\n\n\tif (value < min) {\n\t\tthrow new TypeError(`Expected \\`${name}\\` to be \\u2265 ${min}.`);\n\t}\n}\n\nexport class AbortError extends Error {\n\tconstructor(message) {\n\t\tsuper();\n\n\t\tif (message instanceof Error) {\n\t\t\tthis.originalError = message;\n\t\t\t({message} = message);\n\t\t} else {\n\t\t\tthis.originalError = new Error(message);\n\t\t\tthis.originalError.stack = this.stack;\n\t\t}\n\n\t\tthis.name = 'AbortError';\n\t\tthis.message = message;\n\t}\n}\n\nfunction calculateDelay(retriesConsumed, options) {\n\tconst attempt = Math.max(1, retriesConsumed + 1);\n\tconst random = options.randomize ? (Math.random() + 1) : 1;\n\n\tlet timeout = Math.round(random * options.minTimeout * (options.factor ** (attempt - 1)));\n\ttimeout = Math.min(timeout, options.maxTimeout);\n\n\treturn timeout;\n}\n\nfunction calculateRemainingTime(start, max) {\n\tif (!Number.isFinite(max)) {\n\t\treturn max;\n\t}\n\n\treturn max - (performance.now() - start);\n}\n\nasync function onAttemptFailure({error, attemptNumber, retriesConsumed, startTime, options}) {\n\tconst normalizedError = error instanceof Error\n\t\t? error\n\t\t: new TypeError(`Non-error was thrown: \"${error}\". You should only throw errors.`);\n\n\tif (normalizedError instanceof AbortError) {\n\t\tthrow normalizedError.originalError;\n\t}\n\n\tconst retriesLeft = Number.isFinite(options.retries)\n\t\t? Math.max(0, options.retries - retriesConsumed)\n\t\t: options.retries;\n\n\tconst maxRetryTime = options.maxRetryTime ?? Number.POSITIVE_INFINITY;\n\n\tconst context = Object.freeze({\n\t\terror: normalizedError,\n\t\tattemptNumber,\n\t\tretriesLeft,\n\t\tretriesConsumed,\n\t});\n\n\tawait options.onFailedAttempt(context);\n\n\tif (calculateRemainingTime(startTime, maxRetryTime) <= 0) {\n\t\tthrow normalizedError;\n\t}\n\n\tconst consumeRetry = await options.shouldConsumeRetry(context);\n\n\tconst remainingTime = calculateRemainingTime(startTime, maxRetryTime);\n\n\tif (remainingTime <= 0 || retriesLeft <= 0) {\n\t\tthrow normalizedError;\n\t}\n\n\tif (normalizedError instanceof TypeError && !isNetworkError(normalizedError)) {\n\t\tif (consumeRetry) {\n\t\t\tthrow normalizedError;\n\t\t}\n\n\t\toptions.signal?.throwIfAborted();\n\t\treturn false;\n\t}\n\n\tif (!await options.shouldRetry(context)) {\n\t\tthrow normalizedError;\n\t}\n\n\tif (!consumeRetry) {\n\t\toptions.signal?.throwIfAborted();\n\t\treturn false;\n\t}\n\n\tconst delayTime = calculateDelay(retriesConsumed, options);\n\tconst finalDelay = Math.min(delayTime, remainingTime);\n\n\toptions.signal?.throwIfAborted();\n\n\tif (finalDelay > 0) {\n\t\tawait new Promise((resolve, reject) => {\n\t\t\tconst onAbort = () => {\n\t\t\t\tclearTimeout(timeoutToken);\n\t\t\t\toptions.signal?.removeEventListener('abort', onAbort);\n\t\t\t\treject(options.signal.reason);\n\t\t\t};\n\n\t\t\tconst timeoutToken = setTimeout(() => {\n\t\t\t\toptions.signal?.removeEventListener('abort', onAbort);\n\t\t\t\tresolve();\n\t\t\t}, finalDelay);\n\n\t\t\tif (options.unref) {\n\t\t\t\ttimeoutToken.unref?.();\n\t\t\t}\n\n\t\t\toptions.signal?.addEventListener('abort', onAbort, {once: true});\n\t\t});\n\t}\n\n\toptions.signal?.throwIfAborted();\n\n\treturn true;\n}\n\nexport default async function pRetry(input, options = {}) {\n\toptions = {...options};\n\n\tvalidateRetries(options.retries);\n\n\tif (Object.hasOwn(options, 'forever')) {\n\t\tthrow new Error('The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.');\n\t}\n\n\toptions.retries ??= 10;\n\toptions.factor ??= 2;\n\toptions.minTimeout ??= 1000;\n\toptions.maxTimeout ??= Number.POSITIVE_INFINITY;\n\toptions.maxRetryTime ??= Number.POSITIVE_INFINITY;\n\toptions.randomize ??= false;\n\toptions.onFailedAttempt ??= () => {};\n\toptions.shouldRetry ??= () => true;\n\toptions.shouldConsumeRetry ??= () => true;\n\n\t// Validate numeric options and normalize edge cases\n\tvalidateNumberOption('factor', options.factor, {min: 0, allowInfinity: false});\n\tvalidateNumberOption('minTimeout', options.minTimeout, {min: 0, allowInfinity: false});\n\tvalidateNumberOption('maxTimeout', options.maxTimeout, {min: 0, allowInfinity: true});\n\tvalidateNumberOption('maxRetryTime', options.maxRetryTime, {min: 0, allowInfinity: true});\n\n\t// Treat non-positive factor as 1 to avoid zero backoff or negative behavior\n\tif (!(options.factor > 0)) {\n\t\toptions.factor = 1;\n\t}\n\n\toptions.signal?.throwIfAborted();\n\n\tlet attemptNumber = 0;\n\tlet retriesConsumed = 0;\n\tconst startTime = performance.now();\n\n\twhile (Number.isFinite(options.retries) ? retriesConsumed <= options.retries : true) {\n\t\tattemptNumber++;\n\n\t\ttry {\n\t\t\toptions.signal?.throwIfAborted();\n\n\t\t\tconst result = await input(attemptNumber);\n\n\t\t\toptions.signal?.throwIfAborted();\n\n\t\t\treturn result;\n\t\t} catch (error) {\n\t\t\tif (await onAttemptFailure({\n\t\t\t\terror,\n\t\t\t\tattemptNumber,\n\t\t\t\tretriesConsumed,\n\t\t\t\tstartTime,\n\t\t\t\toptions,\n\t\t\t})) {\n\t\t\t\tretriesConsumed++;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Should not reach here, but in case it does, throw an error\n\tthrow new Error('Retry attempts exhausted without throwing an error.');\n}\n\nexport function makeRetriable(function_, options) {\n\treturn function (...arguments_) {\n\t\treturn pRetry(() => function_.apply(this, arguments_), options);\n\t};\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}