module.exports=[132434,e=>{"use strict";let t;var n,r,o,s,a,i,l,u,c,p,d,h,m,g=e.i(759555);e.i(727480);var f=e.i(666106),y=e.i(384810),v=e.i(711998);e.i(910272);var b=e.i(62018);function _(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function z(e){return Object.fromEntries([...e.headers])}var w=(({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let o=()=>{let e=n.length,r=Array(t);for(let o=0;o<t;o++)r[o]=n[Math.random()*e|0];return r.join("")};if(null==e)return o;if(n.includes(r))throw new g.InvalidArgumentError({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${o()}`})();function k(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var x=["fetch failed","failed to fetch"];function T(e,...t){let n=new Headers(function(e){if(null==e)return{};let t={};if(e instanceof Headers)e.forEach((e,n)=>{t[n.toLowerCase()]=e});else for(let[n,r]of(Array.isArray(e)||(e=Object.entries(e)),e))null!=r&&(t[n.toLowerCase()]=r);return t}(e)),r=n.get("user-agent")||"";return n.set("user-agent",[r,...t].filter(Boolean).join(" ")),Object.fromEntries(n.entries())}var j=/"__proto__"\s*:/,P=/"constructor"\s*:/;function I(e){let t=JSON.parse(e);return null===t||"object"!=typeof t||!1===j.test(e)&&!1===P.test(e)?t:function(e){let t=[e];for(;t.length;){let e=t;for(let n of(t=[],e)){if(Object.prototype.hasOwnProperty.call(n,"__proto__")||Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let e in n){let r=n[e];r&&"object"==typeof r&&t.push(r)}}}return e}(t)}function E(e){let{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch(t){return I(e)}try{return I(e)}finally{Error.stackTraceLimit=t}}var S=Symbol.for("vercel.ai.validator");async function A({value:e,schema:t}){let n=await $({value:e,schema:t});if(!n.success)throw g.TypeValidationError.wrap({value:e,cause:n.error});return n.value}async function $({value:e,schema:t}){var n;let r="object"==typeof t&&null!==t&&S in t&&!0===t[S]&&"validate"in t?t:"function"==typeof t?t():(n=t,{[S]:!0,validate:async e=>{let t=await n["~standard"].validate(e);return null==t.issues?{success:!0,value:t.value}:{success:!1,error:new g.TypeValidationError({value:e,cause:t.issues})}}});try{if(null==r.validate)return{success:!0,value:e,rawValue:e};let t=await r.validate(e);if(t.success)return{success:!0,value:t.value,rawValue:e};return{success:!1,error:g.TypeValidationError.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:g.TypeValidationError.wrap({value:e,cause:t}),rawValue:e}}}async function O({text:e,schema:t}){try{let n=E(e);if(null==t)return n;return A({value:n,schema:t})}catch(t){if(g.JSONParseError.isInstance(t)||g.TypeValidationError.isInstance(t))throw t;throw new g.JSONParseError({text:e,cause:t})}}async function q({text:e,schema:t}){try{let n=E(e);if(null==t)return{success:!0,value:n,rawValue:n};return await $({value:n,schema:t})}catch(t){return{success:!1,error:g.JSONParseError.isInstance(t)?t:new g.JSONParseError({text:e,cause:t}),rawValue:void 0}}}function C(e){try{return E(e),!0}catch(e){return!1}}async function N({provider:e,providerOptions:t,schema:n}){if((null==t?void 0:t[e])==null)return;let r=await $({value:t[e],schema:n});if(!r.success)throw new g.InvalidArgumentError({argument:"providerOptions",message:`invalid ${e} provider options`,cause:r.error});return r.value}var R=()=>globalThis.fetch,Z=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a})=>M({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a}),M=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:o,abortSignal:s,fetch:a=R()})=>{try{let i=await a(e,{method:"POST",headers:T(t,"ai-sdk/provider-utils/3.0.18",function(e=globalThis){var t,n,r;return e.window?"runtime/browser":(null==(t=e.navigator)?void 0:t.userAgent)?`runtime/${e.navigator.userAgent.toLowerCase()}`:(null==(r=null==(n=e.process)?void 0:n.versions)?void 0:r.node)?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}()),body:n.content,signal:s}),l=z(i);if(!i.ok){let t;try{t=await o({response:i,url:e,requestBodyValues:n.values})}catch(t){if(k(t)||g.APICallError.isInstance(t))throw t;throw new g.APICallError({message:"Failed to process error response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}throw t.value}try{return await r({response:i,url:e,requestBodyValues:n.values})}catch(t){if(t instanceof Error&&(k(t)||g.APICallError.isInstance(t)))throw t;throw new g.APICallError({message:"Failed to process successful response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:n}){if(k(e))return e;if(e instanceof TypeError&&x.includes(e.message.toLowerCase())){let r=e.cause;if(null!=r)return new g.APICallError({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:n.values})}},V=Symbol("Let zodToJsonSchema decide on which parser to use"),F={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function K(e,t){return eu(e.type._def,t)}var L=void 0,U=/^[cC][^\s-]{8,}$/,B=/^[0-9a-z]+$/,H=/^[0-9A-HJKMNP-TV-Z]{26}$/,J=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,D=()=>(void 0===L&&(L=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),L),W=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,G=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Y=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,X=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Q=/^[a-zA-Z0-9_-]{21}$/,ee=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function et(e,t){let n={type:"string"};if(e.checks)for(let r of e.checks)switch(r.kind){case"min":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value;break;case"max":n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value;break;case"email":switch(t.emailStrategy){case"format:email":eo(n,"email",r.message,t);break;case"format:idn-email":eo(n,"idn-email",r.message,t);break;case"pattern:zod":es(n,J,r.message,t)}break;case"url":eo(n,"uri",r.message,t);break;case"uuid":eo(n,"uuid",r.message,t);break;case"regex":es(n,r.regex,r.message,t);break;case"cuid":es(n,U,r.message,t);break;case"cuid2":es(n,B,r.message,t);break;case"startsWith":es(n,RegExp(`^${en(r.value,t)}`),r.message,t);break;case"endsWith":es(n,RegExp(`${en(r.value,t)}$`),r.message,t);break;case"datetime":eo(n,"date-time",r.message,t);break;case"date":eo(n,"date",r.message,t);break;case"time":eo(n,"time",r.message,t);break;case"duration":eo(n,"duration",r.message,t);break;case"length":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,r.value):r.value,n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,r.value):r.value;break;case"includes":es(n,RegExp(en(r.value,t)),r.message,t);break;case"ip":"v6"!==r.version&&eo(n,"ipv4",r.message,t),"v4"!==r.version&&eo(n,"ipv6",r.message,t);break;case"base64url":es(n,X,r.message,t);break;case"jwt":es(n,ee,r.message,t);break;case"cidr":"v6"!==r.version&&es(n,W,r.message,t),"v4"!==r.version&&es(n,G,r.message,t);break;case"emoji":es(n,D(),r.message,t);break;case"ulid":es(n,H,r.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":eo(n,"binary",r.message,t);break;case"contentEncoding:base64":n.contentEncoding="base64";break;case"pattern:zod":es(n,Y,r.message,t)}break;case"nanoid":es(n,Q,r.message,t)}return n}function en(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)er.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}var er=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function eo(e,t,n,r){var o;e.format||(null==(o=e.anyOf)?void 0:o.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&r.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function es(e,t,n,r){var o;e.pattern||(null==(o=e.allOf)?void 0:o.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:ea(t,r),...n&&r.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=ea(t,r)}function ea(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},o=r.i?e.source.toLowerCase():e.source,s="",a=!1,i=!1,l=!1;for(let e=0;e<o.length;e++){if(a){s+=o[e],a=!1;continue}if(r.i){if(i){if(o[e].match(/[a-z]/)){l?(s+=o[e],s+=`${o[e-2]}-${o[e]}`.toUpperCase(),l=!1):"-"===o[e+1]&&(null==(n=o[e+2])?void 0:n.match(/[a-z]/))?(s+=o[e],l=!0):s+=`${o[e]}${o[e].toUpperCase()}`;continue}}else if(o[e].match(/[a-z]/)){s+=`[${o[e]}${o[e].toUpperCase()}]`;continue}}if(r.m){if("^"===o[e]){s+=`(^|(?<=[\r
]))`;continue}else if("$"===o[e]){s+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===o[e]){s+=i?`${o[e]}\r
`:`[${o[e]}\r
]`;continue}s+=o[e],"\\"===o[e]?a=!0:i&&"]"===o[e]?i=!1:i||"["!==o[e]||(i=!0)}return s}function ei(e,t){var n,r,o,s,a,i;let l={type:"object",additionalProperties:null!=(n=eu(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))?n:t.allowedAdditionalProperties};if((null==(r=e.keyType)?void 0:r._def.typeName)===b.ZodFirstPartyTypeKind.ZodString&&(null==(o=e.keyType._def.checks)?void 0:o.length)){let{type:n,...r}=et(e.keyType._def,t);return{...l,propertyNames:r}}if((null==(s=e.keyType)?void 0:s._def.typeName)===b.ZodFirstPartyTypeKind.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if((null==(a=e.keyType)?void 0:a._def.typeName)===b.ZodFirstPartyTypeKind.ZodBranded&&e.keyType._def.type._def.typeName===b.ZodFirstPartyTypeKind.ZodString&&(null==(i=e.keyType._def.type._def.checks)?void 0:i.length)){let{type:n,...r}=K(e.keyType._def,t);return{...l,propertyNames:r}}return l}var el={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function eu(e,t,n=!1){var r;let o=t.seen.get(e);if(t.override){let s=null==(r=t.override)?void 0:r.call(t,e,t,o,n);if(s!==V)return s}if(o&&!n){let e=ec(o,t);if(void 0!==e)return e}let s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);let a=((e,t,n)=>{var r,o,s,a,i,l;switch(t){case b.ZodFirstPartyTypeKind.ZodString:return et(e,n);case b.ZodFirstPartyTypeKind.ZodNumber:let u={type:"number"};if(!e.checks)return u;for(let t of e.checks)switch(t.kind){case"int":u.type="integer";break;case"min":t.inclusive?u.minimum=t.value:u.exclusiveMinimum=t.value;break;case"max":t.inclusive?u.maximum=t.value:u.exclusiveMaximum=t.value;break;case"multipleOf":u.multipleOf=t.value}return u;case b.ZodFirstPartyTypeKind.ZodObject:return function(e,t){let n={type:"object",properties:{}},r=[],o=e.shape();for(let e in o){let s=o[e];if(void 0===s||void 0===s._def)continue;let a=function(e){try{return e.isOptional()}catch(e){return!0}}(s),i=eu(s._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==i&&(n.properties[e]=i,a||r.push(e))}r.length&&(n.required=r);let s=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return eu(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==s&&(n.additionalProperties=s),n}(e,n);case b.ZodFirstPartyTypeKind.ZodBigInt:let c={type:"integer",format:"int64"};if(!e.checks)return c;for(let t of e.checks)switch(t.kind){case"min":t.inclusive?c.minimum=t.value:c.exclusiveMinimum=t.value;break;case"max":t.inclusive?c.maximum=t.value:c.exclusiveMaximum=t.value;break;case"multipleOf":c.multipleOf=t.value}return c;case b.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case b.ZodFirstPartyTypeKind.ZodDate:return function e(t,n,r){let o=null!=r?r:n.dateStrategy;if(Array.isArray(o))return{anyOf:o.map((r,o)=>e(t,n,r))};switch(o){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var s=t;let a={type:"integer",format:"unix-time"};for(let e of s.checks)switch(e.kind){case"min":a.minimum=e.value;break;case"max":a.maximum=e.value}return a}}(e,n);case b.ZodFirstPartyTypeKind.ZodUndefined:return{not:{}};case b.ZodFirstPartyTypeKind.ZodNull:return{type:"null"};case b.ZodFirstPartyTypeKind.ZodArray:let p;return p={type:"array"},(null==(s=e.type)?void 0:s._def)&&(null==(i=null==(a=e.type)?void 0:a._def)?void 0:i.typeName)!==b.ZodFirstPartyTypeKind.ZodAny&&(p.items=eu(e.type._def,{...n,currentPath:[...n.currentPath,"items"]})),e.minLength&&(p.minItems=e.minLength.value),e.maxLength&&(p.maxItems=e.maxLength.value),e.exactLength&&(p.minItems=e.exactLength.value,p.maxItems=e.exactLength.value),p;case b.ZodFirstPartyTypeKind.ZodUnion:case b.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:let d,h=e.options instanceof Map?Array.from(e.options.values()):e.options;if(h.every(e=>e._def.typeName in el&&(!e._def.checks||!e._def.checks.length))){let e=h.reduce((e,t)=>{let n=el[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(h.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=h.reduce((e,t)=>{let n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===h.length){let t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:h.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(h.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:h.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return r=e,o=n,(d=(r.options instanceof Map?Array.from(r.options.values()):r.options).map((e,t)=>eu(e._def,{...o,currentPath:[...o.currentPath,"anyOf",`${t}`]})).filter(e=>!!e&&(!o.strictUnions||"object"==typeof e&&Object.keys(e).length>0))).length?{anyOf:d}:void 0;case b.ZodFirstPartyTypeKind.ZodIntersection:let m,g;return m=[eu(e.left._def,{...n,currentPath:[...n.currentPath,"allOf","0"]}),eu(e.right._def,{...n,currentPath:[...n.currentPath,"allOf","1"]})].filter(e=>!!e),g=[],m.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)g.push(...e.allOf);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:n,...r}=e;t=r}g.push(t)}}),g.length?{allOf:g}:void 0;case b.ZodFirstPartyTypeKind.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>eu(e._def,{...n,currentPath:[...n.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:eu(e.rest._def,{...n,currentPath:[...n.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>eu(e._def,{...n,currentPath:[...n.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case b.ZodFirstPartyTypeKind.ZodRecord:return ei(e,n);case b.ZodFirstPartyTypeKind.ZodLiteral:let f;return"bigint"!=(f=typeof e.value)&&"number"!==f&&"boolean"!==f&&"string"!==f?{type:Array.isArray(e.value)?"array":"object"}:{type:"bigint"===f?"integer":f,const:e.value};case b.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:Array.from(e.values)};case b.ZodFirstPartyTypeKind.ZodNativeEnum:let y,v,_;return y=e.values,{type:1===(_=Array.from(new Set((v=Object.keys(e.values).filter(e=>"number"!=typeof y[y[e]]).map(e=>y[e])).map(e=>typeof e)))).length?"string"===_[0]?"string":"number":["string","number"],enum:v};case b.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[el[e.innerType._def.typeName],"null"]};let z=eu(e.innerType._def,{...n,currentPath:[...n.currentPath,"anyOf","0"]});return z&&{anyOf:[z,{type:"null"}]};case b.ZodFirstPartyTypeKind.ZodOptional:if(n.currentPath.toString()===(null==(l=n.propertyPath)?void 0:l.toString()))return eu(e.innerType._def,n);let w=eu(e.innerType._def,{...n,currentPath:[...n.currentPath,"anyOf","1"]});return w?{anyOf:[{not:{}},w]}:{};case b.ZodFirstPartyTypeKind.ZodMap:if("record"===n.mapStrategy)return ei(e,n);return{type:"array",maxItems:125,items:{type:"array",items:[eu(e.keyType._def,{...n,currentPath:[...n.currentPath,"items","items","0"]})||{},eu(e.valueType._def,{...n,currentPath:[...n.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case b.ZodFirstPartyTypeKind.ZodSet:let k;return k={type:"array",uniqueItems:!0,items:eu(e.valueType._def,{...n,currentPath:[...n.currentPath,"items"]})},e.minSize&&(k.minItems=e.minSize.value),e.maxSize&&(k.maxItems=e.maxSize.value),k;case b.ZodFirstPartyTypeKind.ZodLazy:return()=>e.getter()._def;case b.ZodFirstPartyTypeKind.ZodPromise:return eu(e.type._def,n);case b.ZodFirstPartyTypeKind.ZodNaN:case b.ZodFirstPartyTypeKind.ZodNever:return{not:{}};case b.ZodFirstPartyTypeKind.ZodEffects:return"input"===n.effectStrategy?eu(e.schema._def,n):{};case b.ZodFirstPartyTypeKind.ZodAny:case b.ZodFirstPartyTypeKind.ZodUnknown:return{};case b.ZodFirstPartyTypeKind.ZodDefault:return{...eu(e.innerType._def,n),default:e.defaultValue()};case b.ZodFirstPartyTypeKind.ZodBranded:return K(e,n);case b.ZodFirstPartyTypeKind.ZodReadonly:case b.ZodFirstPartyTypeKind.ZodCatch:return eu(e.innerType._def,n);case b.ZodFirstPartyTypeKind.ZodPipeline:if("input"===n.pipeStrategy)return eu(e.in._def,n);if("output"===n.pipeStrategy)return eu(e.out._def,n);let x=eu(e.in._def,{...n,currentPath:[...n.currentPath,"allOf","0"]}),T=eu(e.out._def,{...n,currentPath:[...n.currentPath,"allOf",x?"1":"0"]});return{allOf:[x,T].filter(e=>void 0!==e)};case b.ZodFirstPartyTypeKind.ZodFunction:case b.ZodFirstPartyTypeKind.ZodVoid:case b.ZodFirstPartyTypeKind.ZodSymbol:default:return}})(e,e.typeName,t),i="function"==typeof a?eu(a(),t):a;if(i&&ep(e,t,i),t.postProcess){let n=t.postProcess(i,e,t);return s.jsonSchema=i,n}return s.jsonSchema=i,i}var ec=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:((e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")})(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},ep=(e,t,n)=>(e.description&&(n.description=e.description),n),ed=Symbol.for("vercel.ai.schema");function eh(e,{validate:t}={}){return{[ed]:!0,_type:void 0,[S]:!0,get jsonSchema(){return"function"==typeof e&&(e=e()),e},validate:t}}var em=v.z.object({prompt_tokens:v.z.number().nullish(),completion_tokens:v.z.number().nullish(),prompt_cache_hit_tokens:v.z.number().nullish(),prompt_cache_miss_tokens:v.z.number().nullish(),total_tokens:v.z.number().nullish(),completion_tokens_details:v.z.object({reasoning_tokens:v.z.number().nullish()}).nullish()}).nullish(),eg=v.z.object({error:v.z.object({message:v.z.string(),type:v.z.string().nullish(),param:v.z.any().nullish(),code:v.z.union([v.z.string(),v.z.number()]).nullish()})}),ef=v.z.object({id:v.z.string().nullish(),created:v.z.number().nullish(),model:v.z.string().nullish(),choices:v.z.array(v.z.object({message:v.z.object({role:v.z.literal("assistant").nullish(),content:v.z.string().nullish(),reasoning_content:v.z.string().nullish(),tool_calls:v.z.array(v.z.object({id:v.z.string().nullish(),function:v.z.object({name:v.z.string(),arguments:v.z.string()})})).nullish()}),finish_reason:v.z.string().nullish()})),usage:em}),ey=(n=()=>{var e;return"_zod"in(e=v.z.union([v.z.object({id:v.z.string().nullish(),created:v.z.number().nullish(),model:v.z.string().nullish(),choices:v.z.array(v.z.object({delta:v.z.object({role:v.z.enum(["assistant"]).nullish(),content:v.z.string().nullish(),reasoning_content:v.z.string().nullish(),tool_calls:v.z.array(v.z.object({index:v.z.number(),id:v.z.string().nullish(),function:v.z.object({name:v.z.string().nullish(),arguments:v.z.string().nullish()})})).nullish()}).nullish(),finish_reason:v.z.string().nullish()})),usage:em}),eg]))?eh(()=>y.toJSONSchema(e,{target:"draft-7",io:"output",reused:"inline"}),{validate:async t=>{let n=await f.safeParseAsync(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}}):eh(()=>((e,t)=>{var n;let r,o,s=(o=void 0!==(r="string"==typeof t?{...F,name:t}:{...F,...t}).name?[...r.basePath,r.definitionPath,r.name]:r.basePath,{...r,currentPath:o,propertyPath:void 0,seen:new Map(Object.entries(r.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...r.basePath,r.definitionPath,e],jsonSchema:void 0}]))}),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,n])=>{var r;return{...e,[t]:null!=(r=eu(n._def,{...s,currentPath:[...s.basePath,s.definitionPath,t]},!0))?r:{}}},{}):void 0,i="string"==typeof t?t:(null==t?void 0:t.nameStrategy)==="title"||null==t?void 0:t.name,l=null!=(n=eu(e._def,void 0===i?s:{...s,currentPath:[...s.basePath,s.definitionPath,i]},!1))?n:{},u="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==u&&(l.title=u);let c=void 0===i?a?{...l,[s.definitionPath]:a}:l:{$ref:[..."relative"===s.$refStrategy?[]:s.basePath,s.definitionPath,i].join("/"),[s.definitionPath]:{...a,[i]:l}};return c.$schema="http://json-schema.org/draft-07/schema#",c})(e,{$refStrategy:"none"}),{validate:async t=>{let n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})},()=>(null==t&&(t=n()),t)),ev=v.z.object({thinking:v.z.object({type:v.z.enum(["enabled","disabled"]).optional()}).optional()});function eb({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function e_(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"tool_calls":return"tool-calls";case"insufficient_system_resource":return"error";default:return"unknown"}}var ez=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=t,this.failedResponseHandler=(({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:o,requestBodyValues:s})=>{let a=await r.text(),i=z(r);if(""===a.trim())return{responseHeaders:i,value:new g.APICallError({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,isRetryable:null==n?void 0:n(r)})};try{let l=await O({text:a,schema:e});return{responseHeaders:i,value:new g.APICallError({message:t(l),url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,data:l,isRetryable:null==n?void 0:n(r,l)})}}catch(e){return{responseHeaders:i,value:new g.APICallError({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,isRetryable:null==n?void 0:n(r)})}}})({errorSchema:eg,errorToMessage:e=>e.error.message})}get provider(){return this.config.provider}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:o,frequencyPenalty:s,presencePenalty:a,providerOptions:i,stopSequences:l,responseFormat:u,tools:c,toolChoice:p,seed:d}){var h,m;let f=null!=(h=await N({provider:this.providerOptionsName,providerOptions:i,schema:ev}))?h:{},{messages:y,warnings:v}=function({prompt:e,responseFormat:t}){let n=[],r=[];(null==t?void 0:t.type)==="json"&&(null==t.schema?n.push({role:"system",content:"Return JSON."}):n.push({role:"system",content:"Return JSON that conforms to the following schema: "+JSON.stringify(t.schema)}));let o=-1;for(let t=e.length-1;t>=0;t--)if("user"===e[t].role){o=t;break}let s=-1;for(let{role:t,content:a}of e)switch(s++,t){case"system":n.push({role:"system",content:a});break;case"user":{let e="";for(let t of a)"text"===t.type?e+=t.text:r.push({type:"other",message:`Unsupported user message part type: ${t.type}`});n.push({role:"user",content:e});break}case"assistant":{let e,t="",r=[];for(let n of a)switch(n.type){case"text":t+=n.text;break;case"reasoning":if(s<=o)break;null==e?e=n.text:e+=n.text;break;case"tool-call":r.push({id:n.toolCallId,type:"function",function:{name:n.toolName,arguments:JSON.stringify(n.input)}})}n.push({role:"assistant",content:t,reasoning_content:e,tool_calls:r.length>0?r:void 0});break}case"tool":for(let e of a){let t,r=e.output;switch(r.type){case"text":case"error-text":t=r.value;break;case"content":case"json":case"error-json":t=JSON.stringify(r.value)}n.push({role:"tool",tool_call_id:e.toolCallId,content:t})}break;default:r.push({type:"other",message:`Unsupported message role: ${t}`})}return{messages:n,warnings:r}}({prompt:e,responseFormat:u});null!=o&&v.push({type:"unsupported-setting",setting:"topK"}),null!=d&&v.push({type:"unsupported-setting",setting:"seed"});let{tools:b,toolChoice:_,toolWarnings:z}=function({tools:e,toolChoice:t}){e=(null==e?void 0:e.length)?e:void 0;let n=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)"provider-defined"===t.type?n.push({type:"unsupported-tool",tool:t}):r.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema}});if(null==t)return{tools:r,toolChoice:void 0,toolWarnings:n};let o=t.type;switch(o){case"auto":case"none":case"required":return{tools:r,toolChoice:o,toolWarnings:n};case"tool":return{tools:r,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:throw new g.UnsupportedFunctionalityError({functionality:`tool choice type: ${o}`})}}({tools:c,toolChoice:p});return{args:{model:this.modelId,max_tokens:t,temperature:n,top_p:r,frequency_penalty:s,presence_penalty:a,response_format:(null==u?void 0:u.type)==="json"?{type:"json_object"}:void 0,stop:l,messages:y,tools:b,tool_choice:_,thinking:(null==(m=f.thinking)?void 0:m.type)!=null?{type:f.thinking.type}:void 0},warnings:[...v,...z]}}async doGenerate(e){var t,n,r,o,s,a,i,l,u,c,p,d,h,m,f,y;let{args:v,warnings:b}=await this.getArgs({...e}),{responseHeaders:k,value:x,rawValue:T}=await Z({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:_(this.config.headers(),e.headers),body:v,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:async({response:e,url:t,requestBodyValues:n})=>{let r=await e.text(),o=await q({text:r,schema:ef}),s=z(e);if(!o.success)throw new g.APICallError({message:"Invalid JSON response",cause:o.error,statusCode:e.status,responseHeaders:s,responseBody:r,url:t,requestBodyValues:n});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}},abortSignal:e.abortSignal,fetch:this.config.fetch}),j=x.choices[0],P=[],I=j.message.reasoning_content;if(null!=I&&I.length>0&&P.push({type:"reasoning",text:I}),null!=j.message.tool_calls)for(let e of j.message.tool_calls)P.push({type:"tool-call",toolCallId:null!=(t=e.id)?t:w(),toolName:e.function.name,input:e.function.arguments});let E=j.message.content;return null!=E&&E.length>0&&P.push({type:"text",text:E}),{content:P,finishReason:e_(j.finish_reason),usage:{inputTokens:null!=(r=null==(n=x.usage)?void 0:n.prompt_tokens)?r:void 0,outputTokens:null!=(s=null==(o=x.usage)?void 0:o.completion_tokens)?s:void 0,totalTokens:null!=(i=null==(a=x.usage)?void 0:a.total_tokens)?i:void 0,reasoningTokens:null!=(c=null==(u=null==(l=x.usage)?void 0:l.completion_tokens_details)?void 0:u.reasoning_tokens)?c:void 0,cachedInputTokens:null!=(d=null==(p=x.usage)?void 0:p.prompt_cache_hit_tokens)?d:void 0},providerMetadata:{[this.providerOptionsName]:{promptCacheHitTokens:null!=(m=null==(h=x.usage)?void 0:h.prompt_cache_hit_tokens)?m:null,promptCacheMissTokens:null!=(y=null==(f=x.usage)?void 0:f.prompt_cache_miss_tokens)?y:null}},request:{body:v},response:{...eb(x),headers:k,body:T},warnings:b}}async doStream(e){let t,{args:n,warnings:r}=await this.getArgs({...e}),o={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:s,value:a}=await Z({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:_(this.config.headers(),e.headers),body:o,failedResponseHandler:this.failedResponseHandler,successfulResponseHandler:async({response:e})=>{let t=z(e);if(null==e.body)throw new g.EmptyResponseBodyError({});return{responseHeaders:t,value:function({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new g.EventSourceParserStream).pipeThrough(new TransformStream({async transform({data:e},n){"[DONE]"!==e&&n.enqueue(await q({text:e,schema:t}))}}))}({stream:e.body,schema:ey})}},abortSignal:e.abortSignal,fetch:this.config.fetch}),i=[],l="unknown",u=!0,c=this.providerOptionsName,p=!1,d=!1;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:r})},transform(n,r){var o,s,a,c,h,m,f,y,v,b,_,z;if(e.includeRawChunks&&r.enqueue({type:"raw",rawValue:n.rawValue}),!n.success){l="error",r.enqueue({type:"error",error:n.error});return}let k=n.value;if("error"in k){l="error",r.enqueue({type:"error",error:k.error.message});return}u&&(u=!1,r.enqueue({type:"response-metadata",...eb(k)})),null!=k.usage&&(t=k.usage);let x=k.choices[0];if((null==x?void 0:x.finish_reason)!=null&&(l=e_(x.finish_reason)),(null==x?void 0:x.delta)==null)return;let T=x.delta,j=T.reasoning_content;if(j&&(p||(r.enqueue({type:"reasoning-start",id:"reasoning-0"}),p=!0),r.enqueue({type:"reasoning-delta",id:"reasoning-0",delta:j})),T.content&&(d||(r.enqueue({type:"text-start",id:"txt-0"}),d=!0),p&&(r.enqueue({type:"reasoning-end",id:"reasoning-0"}),p=!1),r.enqueue({type:"text-delta",id:"txt-0",delta:T.content})),null!=T.tool_calls)for(let e of(p&&(r.enqueue({type:"reasoning-end",id:"reasoning-0"}),p=!1),T.tool_calls)){let t=e.index;if(null==i[t]){if(null==e.id)throw new g.InvalidResponseDataError({data:e,message:"Expected 'id' to be a string."});if((null==(o=e.function)?void 0:o.name)==null)throw new g.InvalidResponseDataError({data:e,message:"Expected 'function.name' to be a string."});r.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),i[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(s=e.function.arguments)?s:""},hasFinished:!1};let n=i[t];(null==(a=n.function)?void 0:a.name)!=null&&(null==(c=n.function)?void 0:c.arguments)!=null&&(n.function.arguments.length>0&&r.enqueue({type:"tool-input-delta",id:n.id,delta:n.function.arguments}),C(n.function.arguments)&&(r.enqueue({type:"tool-input-end",id:n.id}),r.enqueue({type:"tool-call",toolCallId:null!=(h=n.id)?h:w(),toolName:n.function.name,input:n.function.arguments}),n.hasFinished=!0));continue}let n=i[t];!n.hasFinished&&((null==(m=e.function)?void 0:m.arguments)!=null&&(n.function.arguments+=null!=(y=null==(f=e.function)?void 0:f.arguments)?y:""),r.enqueue({type:"tool-input-delta",id:n.id,delta:null!=(v=e.function.arguments)?v:""}),(null==(b=n.function)?void 0:b.name)!=null&&(null==(_=n.function)?void 0:_.arguments)!=null&&C(n.function.arguments)&&(r.enqueue({type:"tool-input-end",id:n.id}),r.enqueue({type:"tool-call",toolCallId:null!=(z=n.id)?z:w(),toolName:n.function.name,input:n.function.arguments}),n.hasFinished=!0))}},flush(e){var n,r,o,s,a,u,h,m,g;for(let t of(p&&e.enqueue({type:"reasoning-end",id:"reasoning-0"}),d&&e.enqueue({type:"text-end",id:"txt-0"}),i.filter(e=>!e.hasFinished)))e.enqueue({type:"tool-input-end",id:t.id}),e.enqueue({type:"tool-call",toolCallId:null!=(n=t.id)?n:w(),toolName:t.function.name,input:t.function.arguments});e.enqueue({type:"finish",finishReason:l,usage:{inputTokens:null!=(r=null==t?void 0:t.prompt_tokens)?r:void 0,outputTokens:null!=(o=null==t?void 0:t.completion_tokens)?o:void 0,totalTokens:null!=(s=null==t?void 0:t.total_tokens)?s:void 0,reasoningTokens:null!=(u=null==(a=null==t?void 0:t.completion_tokens_details)?void 0:a.reasoning_tokens)?u:void 0,cachedInputTokens:null!=(h=null==t?void 0:t.prompt_cache_hit_tokens)?h:void 0},providerMetadata:{[c]:{promptCacheHitTokens:null!=(m=null==t?void 0:t.prompt_cache_hit_tokens)?m:null,promptCacheMissTokens:null!=(g=null==t?void 0:t.prompt_cache_miss_tokens)?g:null}}})}})),request:{body:o},response:{headers:s}}}};function ew(e={}){var t,n;let r=null==(n=null!=(t=e.baseURL)?t:"https://api.deepseek.com")?void 0:n.replace(/\/$/,""),o=()=>T({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if("string"==typeof e)return e;if(null!=e)throw new g.LoadAPIKeyError({message:`${r} API key must be a string.`});if("u"<typeof process)throw new g.LoadAPIKeyError({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new g.LoadAPIKeyError({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new g.LoadAPIKeyError({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"DEEPSEEK_API_KEY",description:"DeepSeek API key"})}`,...e.headers},"ai-sdk/deepseek/1.0.31"),s=t=>new ez(t,{provider:"deepseek.chat",url:({path:e})=>`${r}${e}`,headers:o,fetch:e.fetch}),a=e=>s(e);return a.languageModel=s,a.chat=s,a.textEmbeddingModel=e=>{throw new g.NoSuchModelError({modelId:e,modelType:"textEmbeddingModel"})},a.imageModel=e=>{throw new g.NoSuchModelError({modelId:e,modelType:"imageModel"})},a}function ek({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function ex(e){switch(e){case"stop":return"stop";case"length":case"model_length":return"length";case"tool_calls":return"tool-calls";default:return"unknown"}}ew();var eT=v.z.object({safePrompt:v.z.boolean().optional(),documentImageLimit:v.z.number().optional(),documentPageLimit:v.z.number().optional(),structuredOutputs:v.z.boolean().optional(),strictJsonSchema:v.z.boolean().optional(),parallelToolCalls:v.z.boolean().optional()}),ej=v.z.object({object:v.z.literal("error"),message:v.z.string(),type:v.z.string(),param:v.z.string().nullable(),code:v.z.string().nullable()}),eP=(0,g.createJsonErrorResponseHandler)({errorSchema:ej,errorToMessage:e=>e.message}),eI=class{constructor(e,t){var n;this.specificationVersion="v2",this.supportedUrls={"application/pdf":[/^https:\/\/.*$/]},this.modelId=e,this.config=t,this.generateId=null!=(n=t.generateId)?n:g.generateId}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:o,frequencyPenalty:s,presencePenalty:a,stopSequences:i,responseFormat:l,seed:u,providerOptions:c,tools:p,toolChoice:d}){var h,m,f,y;let v=[],b=null!=(h=await (0,g.parseProviderOptions)({provider:"mistral",providerOptions:c,schema:eT}))?h:{};null!=o&&v.push({type:"unsupported-setting",setting:"topK"}),null!=s&&v.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=a&&v.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=i&&v.push({type:"unsupported-setting",setting:"stopSequences"});let _=null==(m=b.structuredOutputs)||m,z=null!=(f=b.strictJsonSchema)&&f;(null==l?void 0:l.type)!=="json"||(null==l?void 0:l.schema)||(e=(0,g.injectJsonInstructionIntoMessages)({messages:e,schema:l.schema}));let w={model:this.modelId,safe_prompt:b.safePrompt,max_tokens:t,temperature:n,top_p:r,random_seed:u,response_format:(null==l?void 0:l.type)==="json"?_&&(null==l?void 0:l.schema)!=null?{type:"json_schema",json_schema:{schema:l.schema,strict:z,name:null!=(y=l.name)?y:"response",description:l.description}}:{type:"json_object"}:void 0,document_image_limit:b.documentImageLimit,document_page_limit:b.documentPageLimit,messages:function(e){let t=[];for(let n=0;n<e.length;n++){let{role:r,content:o}=e[n],s=n===e.length-1;switch(r){case"system":t.push({role:"system",content:o});break;case"user":t.push({role:"user",content:o.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:e.data instanceof URL?e.data.toString():`data:${t};base64,${(0,g.convertToBase64)(e.data)}`}}if("application/pdf"===e.mediaType)return{type:"document_url",document_url:e.data.toString()};throw new g.UnsupportedFunctionalityError({functionality:"Only images and PDF file parts are supported"})}})});break;case"assistant":{let e="",n=[];for(let t of o)switch(t.type){case"text":case"reasoning":e+=t.text;break;case"tool-call":n.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.input)}});break;default:throw Error(`Unsupported content type in assistant message: ${t.type}`)}t.push({role:"assistant",content:e,prefix:!!s||void 0,tool_calls:n.length>0?n:void 0});break}case"tool":for(let e of o){let n,r=e.output;switch(r.type){case"text":case"error-text":n=r.value;break;case"content":case"json":case"error-json":n=JSON.stringify(r.value)}t.push({role:"tool",name:e.toolName,tool_call_id:e.toolCallId,content:n})}break;default:throw Error(`Unsupported role: ${r}`)}}return t}(e)},{tools:k,toolChoice:x,toolWarnings:T}=function({tools:e,toolChoice:t}){e=(null==e?void 0:e.length)?e:void 0;let n=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)"provider-defined"===t.type?n.push({type:"unsupported-tool",tool:t}):r.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema}});if(null==t)return{tools:r,toolChoice:void 0,toolWarnings:n};let o=t.type;switch(o){case"auto":case"none":return{tools:r,toolChoice:o,toolWarnings:n};case"required":return{tools:r,toolChoice:"any",toolWarnings:n};case"tool":return{tools:r.filter(e=>e.function.name===t.toolName),toolChoice:"any",toolWarnings:n};default:throw new g.UnsupportedFunctionalityError({functionality:`tool choice type: ${o}`})}}({tools:p,toolChoice:d});return{args:{...w,tools:k,tool_choice:x,...null!=k&&void 0!==b.parallelToolCalls?{parallel_tool_calls:b.parallelToolCalls}:{}},warnings:[...v,...T]}}async doGenerate(e){let{args:t,warnings:n}=await this.getArgs(e),{responseHeaders:r,value:o,rawValue:s}=await (0,g.postJsonToApi)({url:`${this.config.baseURL}/chat/completions`,headers:(0,g.combineHeaders)(this.config.headers(),e.headers),body:t,failedResponseHandler:eP,successfulResponseHandler:(0,g.createJsonResponseHandler)(eO),abortSignal:e.abortSignal,fetch:this.config.fetch}),a=o.choices[0],i=[];if(null!=a.message.content&&Array.isArray(a.message.content))for(let e of a.message.content)if("thinking"===e.type){let t=eE(e.thinking);t.length>0&&i.push({type:"reasoning",text:t})}else"text"===e.type&&e.text.length>0&&i.push({type:"text",text:e.text});else{let e=eS(a.message.content);null!=e&&e.length>0&&i.push({type:"text",text:e})}if(null!=a.message.tool_calls)for(let e of a.message.tool_calls)i.push({type:"tool-call",toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});return{content:i,finishReason:ex(a.finish_reason),usage:{inputTokens:o.usage.prompt_tokens,outputTokens:o.usage.completion_tokens,totalTokens:o.usage.total_tokens},request:{body:t},response:{...ek(o),headers:r,body:s},warnings:n}}async doStream(e){let{args:t,warnings:n}=await this.getArgs(e),r={...t,stream:!0},{responseHeaders:o,value:s}=await (0,g.postJsonToApi)({url:`${this.config.baseURL}/chat/completions`,headers:(0,g.combineHeaders)(this.config.headers(),e.headers),body:r,failedResponseHandler:eP,successfulResponseHandler:(0,g.createEventSourceResponseHandler)(eq),abortSignal:e.abortSignal,fetch:this.config.fetch}),a="unknown",i={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l=!0,u=!1,c=null,p=this.generateId;return{stream:s.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void n.enqueue({type:"error",error:t.error});let r=t.value;l&&(l=!1,n.enqueue({type:"response-metadata",...ek(r)})),null!=r.usage&&(i.inputTokens=r.usage.prompt_tokens,i.outputTokens=r.usage.completion_tokens,i.totalTokens=r.usage.total_tokens);let o=r.choices[0],s=o.delta,d=eS(s.content);if(null!=s.content&&Array.isArray(s.content)){for(let e of s.content)if("thinking"===e.type){let t=eE(e.thinking);t.length>0&&(null==c&&(u&&(n.enqueue({type:"text-end",id:"0"}),u=!1),c=p(),n.enqueue({type:"reasoning-start",id:c})),n.enqueue({type:"reasoning-delta",id:c,delta:t}))}}if(null!=d&&d.length>0&&(u||(null!=c&&(n.enqueue({type:"reasoning-end",id:c}),c=null),n.enqueue({type:"text-start",id:"0"}),u=!0),n.enqueue({type:"text-delta",id:"0",delta:d})),(null==s?void 0:s.tool_calls)!=null)for(let e of s.tool_calls){let t=e.id,r=e.function.name,o=e.function.arguments;n.enqueue({type:"tool-input-start",id:t,toolName:r}),n.enqueue({type:"tool-input-delta",id:t,delta:o}),n.enqueue({type:"tool-input-end",id:t}),n.enqueue({type:"tool-call",toolCallId:t,toolName:r,input:o})}null!=o.finish_reason&&(a=ex(o.finish_reason))},flush(e){null!=c&&e.enqueue({type:"reasoning-end",id:c}),u&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:a,usage:i})}})),request:{body:r},response:{headers:o}}}};function eE(e){return e.filter(e=>"text"===e.type).map(e=>e.text).join("")}function eS(e){if("string"==typeof e)return e;if(null==e)return;let t=[];for(let n of e){let{type:e}=n;switch(e){case"text":t.push(n.text);break;case"thinking":case"image_url":case"reference":break;default:throw Error(`Unsupported type: ${e}`)}}return t.length?t.join(""):void 0}var eA=v.z.union([v.z.string(),v.z.array(v.z.discriminatedUnion("type",[v.z.object({type:v.z.literal("text"),text:v.z.string()}),v.z.object({type:v.z.literal("image_url"),image_url:v.z.union([v.z.string(),v.z.object({url:v.z.string(),detail:v.z.string().nullable()})])}),v.z.object({type:v.z.literal("reference"),reference_ids:v.z.array(v.z.number())}),v.z.object({type:v.z.literal("thinking"),thinking:v.z.array(v.z.object({type:v.z.literal("text"),text:v.z.string()}))})]))]).nullish(),e$=v.z.object({prompt_tokens:v.z.number(),completion_tokens:v.z.number(),total_tokens:v.z.number()}),eO=v.z.object({id:v.z.string().nullish(),created:v.z.number().nullish(),model:v.z.string().nullish(),choices:v.z.array(v.z.object({message:v.z.object({role:v.z.literal("assistant"),content:eA,tool_calls:v.z.array(v.z.object({id:v.z.string(),function:v.z.object({name:v.z.string(),arguments:v.z.string()})})).nullish()}),index:v.z.number(),finish_reason:v.z.string().nullish()})),object:v.z.literal("chat.completion"),usage:e$}),eq=v.z.object({id:v.z.string().nullish(),created:v.z.number().nullish(),model:v.z.string().nullish(),choices:v.z.array(v.z.object({delta:v.z.object({role:v.z.enum(["assistant"]).optional(),content:eA,tool_calls:v.z.array(v.z.object({id:v.z.string(),function:v.z.object({name:v.z.string(),arguments:v.z.string()})})).nullish()}),finish_reason:v.z.string().nullish(),index:v.z.number()})),usage:e$.nullish()}),eC=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=32,this.supportsParallelCalls=!1,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,abortSignal:t,headers:n}){if(e.length>this.maxEmbeddingsPerCall)throw new g.TooManyEmbeddingValuesForCallError({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:r,value:o,rawValue:s}=await (0,g.postJsonToApi)({url:`${this.config.baseURL}/embeddings`,headers:(0,g.combineHeaders)(this.config.headers(),n),body:{model:this.modelId,input:e,encoding_format:"float"},failedResponseHandler:eP,successfulResponseHandler:(0,g.createJsonResponseHandler)(eN),abortSignal:t,fetch:this.config.fetch});return{embeddings:o.data.map(e=>e.embedding),usage:o.usage?{tokens:o.usage.prompt_tokens}:void 0,response:{headers:r,body:s}}}},eN=v.z.object({data:v.z.array(v.z.object({embedding:v.z.array(v.z.number())})),usage:v.z.object({prompt_tokens:v.z.number()}).nullish()});function eR(e={}){var t;let n=null!=(t=(0,g.withoutTrailingSlash)(e.baseURL))?t:"https://api.mistral.ai/v1",r=()=>(0,g.withUserAgentSuffix)({Authorization:`Bearer ${(0,g.loadApiKey)({apiKey:e.apiKey,environmentVariableName:"MISTRAL_API_KEY",description:"Mistral"})}`,...e.headers},"ai-sdk/mistral/2.0.24"),o=t=>new eI(t,{provider:"mistral.chat",baseURL:n,headers:r,fetch:e.fetch,generateId:e.generateId}),s=t=>new eC(t,{provider:"mistral.embedding",baseURL:n,headers:r,fetch:e.fetch}),a=function(e){if(new.target)throw Error("The Mistral model function cannot be called with the new keyword.");return o(e)};return a.languageModel=o,a.chat=o,a.embedding=s,a.textEmbedding=s,a.textEmbeddingModel=s,a.imageModel=e=>{throw new g.NoSuchModelError({modelId:e,modelType:"imageModel"})},a}function eZ(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function eM(e){return Object.fromEntries([...e.headers])}eR();var eV=(({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let o=()=>{let e=n.length,r=Array(t);for(let o=0;o<t;o++)r[o]=n[Math.random()*e|0];return r.join("")};if(null==e)return o;if(n.includes(r))throw new g.InvalidArgumentError({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${o()}`})();function eF(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var eK=["fetch failed","failed to fetch"],eL=/"__proto__"\s*:/,eU=/"constructor"\s*:/;function eB(e){let{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{let t;return t=JSON.parse(e),null===t||"object"!=typeof t||!1===eL.test(e)&&!1===eU.test(e)?t:function(e){let t=[e];for(;t.length;){let e=t;for(let n of(t=[],e)){if(Object.prototype.hasOwnProperty.call(n,"__proto__")||Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let e in n){let r=n[e];r&&"object"==typeof r&&t.push(r)}}}return e}(t)}finally{Error.stackTraceLimit=t}}var eH=Symbol.for("vercel.ai.validator");async function eJ({value:e,schema:t}){let n=await eD({value:e,schema:t});if(!n.success)throw g.TypeValidationError.wrap({value:e,cause:n.error});return n.value}async function eD({value:e,schema:t}){var n;let r="object"==typeof t&&null!==t&&eH in t&&!0===t[eH]&&"validate"in t?t:(n=t,{[eH]:!0,validate:async e=>{let t=await n["~standard"].validate(e);return null==t.issues?{success:!0,value:t.value}:{success:!1,error:new g.TypeValidationError({value:e,cause:t.issues})}}});try{if(null==r.validate)return{success:!0,value:e,rawValue:e};let t=await r.validate(e);if(t.success)return{success:!0,value:t.value,rawValue:e};return{success:!1,error:g.TypeValidationError.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:g.TypeValidationError.wrap({value:e,cause:t}),rawValue:e}}}async function eW({text:e,schema:t}){try{let n=eB(e);if(null==t)return n;return eJ({value:n,schema:t})}catch(t){if(g.JSONParseError.isInstance(t)||g.TypeValidationError.isInstance(t))throw t;throw new g.JSONParseError({text:e,cause:t})}}async function eG({text:e,schema:t}){try{let n=eB(e);if(null==t)return{success:!0,value:n,rawValue:n};return await eD({value:n,schema:t})}catch(t){return{success:!1,error:g.JSONParseError.isInstance(t)?t:new g.JSONParseError({text:e,cause:t}),rawValue:void 0}}}var eY=()=>globalThis.fetch,eX=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a})=>eQ({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a}),eQ=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:o,abortSignal:s,fetch:a=eY()})=>{try{let i=await a(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:n.content,signal:s}),l=eM(i);if(!i.ok){let t;try{t=await o({response:i,url:e,requestBodyValues:n.values})}catch(t){if(eF(t)||g.APICallError.isInstance(t))throw t;throw new g.APICallError({message:"Failed to process error response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}throw t.value}try{return await r({response:i,url:e,requestBodyValues:n.values})}catch(t){if(t instanceof Error&&(eF(t)||g.APICallError.isInstance(t)))throw t;throw new g.APICallError({message:"Failed to process successful response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:n}){if(eF(e))return e;if(e instanceof TypeError&&eK.includes(e.message.toLowerCase())){let r=e.cause;if(null!=r)return new g.APICallError({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:n.values})}},e0=({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:o,requestBodyValues:s})=>{let a=await r.text(),i=eM(r);if(""===a.trim())return{responseHeaders:i,value:new g.APICallError({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,isRetryable:null==n?void 0:n(r)})};try{let l=await eW({text:a,schema:e});return{responseHeaders:i,value:new g.APICallError({message:t(l),url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,data:l,isRetryable:null==n?void 0:n(r,l)})}}catch(e){return{responseHeaders:i,value:new g.APICallError({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,isRetryable:null==n?void 0:n(r)})}}},{btoa:e1}=globalThis;function e9(e){switch(e){case"stop":case"length":return e;default:return"unknown"}}var e4=class{constructor(e,t){this.specificationVersion="v2",this.provider="perplexity",this.supportedUrls={},this.modelId=e,this.config=t}getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:o,frequencyPenalty:s,presencePenalty:a,stopSequences:i,responseFormat:l,seed:u,providerOptions:c}){var p;let d=[];return null!=o&&d.push({type:"unsupported-setting",setting:"topK"}),null!=i&&d.push({type:"unsupported-setting",setting:"stopSequences"}),null!=u&&d.push({type:"unsupported-setting",setting:"seed"}),{args:{model:this.modelId,frequency_penalty:s,max_tokens:t,presence_penalty:a,temperature:n,top_k:o,top_p:r,response_format:(null==l?void 0:l.type)==="json"?{type:"json_schema",json_schema:{schema:l.schema}}:void 0,...null!=(p=null==c?void 0:c.perplexity)?p:{},messages:function(e){let t=[];for(let{role:n,content:r}of e)switch(n){case"system":t.push({role:"system",content:r});break;case"user":case"assistant":{let e=r.some(e=>"file"===e.type&&e.mediaType.startsWith("image/")),o=r.map(e=>{var t;switch(e.type){case"text":return{type:"text",text:e.text};case"file":return e.data instanceof URL?{type:"image_url",image_url:{url:e.data.toString()}}:{type:"image_url",image_url:{url:`data:${null!=(t=e.mediaType)?t:"image/jpeg"};base64,${"string"==typeof e.data?e.data:function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return e1(t)}(e.data)}`}}}}).filter(Boolean);t.push({role:n,content:e?o:o.filter(e=>"text"===e.type).map(e=>e.text).join("")});break}case"tool":throw new g.UnsupportedFunctionalityError({functionality:"Tool messages"});default:throw Error(`Unsupported role: ${n}`)}return t}(e)},warnings:d}}async doGenerate(e){var t,n,r,o,s,a,i,l,u,c;let{args:p,warnings:d}=this.getArgs(e),{responseHeaders:h,value:m,rawValue:f}=await eX({url:`${this.config.baseURL}/chat/completions`,headers:eZ(this.config.headers(),e.headers),body:p,failedResponseHandler:e0({errorSchema:e8,errorToMessage:te}),successfulResponseHandler:async({response:e,url:t,requestBodyValues:n})=>{let r=await e.text(),o=await eG({text:r,schema:e5}),s=eM(e);if(!o.success)throw new g.APICallError({message:"Invalid JSON response",cause:o.error,statusCode:e.status,responseHeaders:s,responseBody:r,url:t,requestBodyValues:n});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}},abortSignal:e.abortSignal,fetch:this.config.fetch}),y=m.choices[0],v=[],b=y.message.content;if(b.length>0&&v.push({type:"text",text:b}),null!=m.citations)for(let e of m.citations)v.push({type:"source",sourceType:"url",id:this.config.generateId(),url:e});return{content:v,finishReason:e9(y.finish_reason),usage:{inputTokens:null==(t=m.usage)?void 0:t.prompt_tokens,outputTokens:null==(n=m.usage)?void 0:n.completion_tokens,totalTokens:null!=(o=null==(r=m.usage)?void 0:r.total_tokens)?o:void 0},request:{body:p},response:{...e2(m),headers:h,body:f},warnings:d,providerMetadata:{perplexity:{images:null!=(a=null==(s=m.images)?void 0:s.map(e=>({imageUrl:e.image_url,originUrl:e.origin_url,height:e.height,width:e.width})))?a:null,usage:{citationTokens:null!=(l=null==(i=m.usage)?void 0:i.citation_tokens)?l:null,numSearchQueries:null!=(c=null==(u=m.usage)?void 0:u.num_search_queries)?c:null}}}}}async doStream(e){let{args:t,warnings:n}=this.getArgs(e),r={...t,stream:!0},{responseHeaders:o,value:s}=await eX({url:`${this.config.baseURL}/chat/completions`,headers:eZ(this.config.headers(),e.headers),body:r,failedResponseHandler:e0({errorSchema:e8,errorToMessage:te}),successfulResponseHandler:async({response:e})=>{let t=eM(e);if(null==e.body)throw new g.EmptyResponseBodyError({});return{responseHeaders:t,value:function({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new g.EventSourceParserStream).pipeThrough(new TransformStream({async transform({data:e},n){"[DONE]"!==e&&n.enqueue(await eG({text:e,schema:t}))}}))}({stream:e.body,schema:e7})}},abortSignal:e.abortSignal,fetch:this.config.fetch}),a="unknown",i={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},l={perplexity:{usage:{citationTokens:null,numSearchQueries:null},images:null}},u=!0,c=!1,p=this;return{stream:s.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:n})},transform(t,n){var r,o,s;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void n.enqueue({type:"error",error:t.error});let d=t.value;u&&(n.enqueue({type:"response-metadata",...e2(d)}),null==(r=d.citations)||r.forEach(e=>{n.enqueue({type:"source",sourceType:"url",id:p.config.generateId(),url:e})}),u=!1),null!=d.usage&&(i.inputTokens=d.usage.prompt_tokens,i.outputTokens=d.usage.completion_tokens,l.perplexity.usage={citationTokens:null!=(o=d.usage.citation_tokens)?o:null,numSearchQueries:null!=(s=d.usage.num_search_queries)?s:null}),null!=d.images&&(l.perplexity.images=d.images.map(e=>({imageUrl:e.image_url,originUrl:e.origin_url,height:e.height,width:e.width})));let h=d.choices[0];if((null==h?void 0:h.finish_reason)!=null&&(a=e9(h.finish_reason)),(null==h?void 0:h.delta)==null)return;let m=h.delta.content;null!=m&&(c||(n.enqueue({type:"text-start",id:"0"}),c=!0),n.enqueue({type:"text-delta",id:"0",delta:m}))},flush(e){c&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:a,usage:i,providerMetadata:l})}})),request:{body:r},response:{headers:o}}}};function e2({id:e,model:t,created:n}){return{id:e,modelId:t,timestamp:new Date(1e3*n)}}var e6=v.z.object({prompt_tokens:v.z.number(),completion_tokens:v.z.number(),total_tokens:v.z.number().nullish(),citation_tokens:v.z.number().nullish(),num_search_queries:v.z.number().nullish()}),e3=v.z.object({image_url:v.z.string(),origin_url:v.z.string(),height:v.z.number(),width:v.z.number()}),e5=v.z.object({id:v.z.string(),created:v.z.number(),model:v.z.string(),choices:v.z.array(v.z.object({message:v.z.object({role:v.z.literal("assistant"),content:v.z.string()}),finish_reason:v.z.string().nullish()})),citations:v.z.array(v.z.string()).nullish(),images:v.z.array(e3).nullish(),usage:e6.nullish()}),e7=v.z.object({id:v.z.string(),created:v.z.number(),model:v.z.string(),choices:v.z.array(v.z.object({delta:v.z.object({role:v.z.literal("assistant"),content:v.z.string()}),finish_reason:v.z.string().nullish()})),citations:v.z.array(v.z.string()).nullish(),images:v.z.array(e3).nullish(),usage:e6.nullish()}),e8=v.z.object({error:v.z.object({code:v.z.number(),message:v.z.string().nullish(),type:v.z.string().nullish()})}),te=e=>{var t,n;return null!=(n=null!=(t=e.error.message)?t:e.error.type)?n:"unknown error"};function tt(e={}){let t=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if("string"==typeof e)return e;if(null!=e)throw new g.LoadAPIKeyError({message:`${r} API key must be a string.`});if("u"<typeof process)throw new g.LoadAPIKeyError({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new g.LoadAPIKeyError({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new g.LoadAPIKeyError({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"PERPLEXITY_API_KEY",description:"Perplexity"})}`,...e.headers}),n=n=>{var r,o;return new e4(n,{baseURL:null==(o=null!=(r=e.baseURL)?r:"https://api.perplexity.ai")?void 0:o.replace(/\/$/,""),headers:t,generateId:eV,fetch:e.fetch})},r=e=>n(e);return r.languageModel=n,r.textEmbeddingModel=e=>{throw new g.NoSuchModelError({modelId:e,modelType:"textEmbeddingModel"})},r.imageModel=e=>{throw new g.NoSuchModelError({modelId:e,modelType:"imageModel"})},r}function tn({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function tr(e){switch(e){case"stop":return"stop";case"length":return"length";case"tool_calls":case"function_call":return"tool-calls";case"content_filter":return"content-filter";default:return"unknown"}}tt();var to=v.z.object({type:v.z.literal("web"),country:v.z.string().length(2).optional(),excludedWebsites:v.z.array(v.z.string()).max(5).optional(),allowedWebsites:v.z.array(v.z.string()).max(5).optional(),safeSearch:v.z.boolean().optional()}),ts=v.z.object({type:v.z.literal("x"),excludedXHandles:v.z.array(v.z.string()).optional(),includedXHandles:v.z.array(v.z.string()).optional(),postFavoriteCount:v.z.number().int().optional(),postViewCount:v.z.number().int().optional(),xHandles:v.z.array(v.z.string()).optional()}),ta=v.z.object({type:v.z.literal("news"),country:v.z.string().length(2).optional(),excludedWebsites:v.z.array(v.z.string()).max(5).optional(),safeSearch:v.z.boolean().optional()}),ti=v.z.object({type:v.z.literal("rss"),links:v.z.array(v.z.string().url()).max(1)}),tl=v.z.discriminatedUnion("type",[to,ts,ta,ti]),tu=v.z.object({reasoningEffort:v.z.enum(["low","high"]).optional(),parallel_function_calling:v.z.boolean().optional(),searchParameters:v.z.object({mode:v.z.enum(["off","auto","on"]),returnCitations:v.z.boolean().optional(),fromDate:v.z.string().optional(),toDate:v.z.string().optional(),maxSearchResults:v.z.number().min(1).max(50).optional(),sources:v.z.array(tl).optional()}).optional()}),tc=v.z.object({error:v.z.object({message:v.z.string(),type:v.z.string().nullish(),param:v.z.any().nullish(),code:v.z.union([v.z.string(),v.z.number()]).nullish()})}),tp=(0,g.createJsonErrorResponseHandler)({errorSchema:tc,errorToMessage:e=>e.error.message}),td=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,topK:o,frequencyPenalty:s,presencePenalty:a,stopSequences:i,seed:l,responseFormat:u,providerOptions:c,tools:p,toolChoice:d}){var h,m,f;let y=[],v=null!=(h=await (0,g.parseProviderOptions)({provider:"xai",providerOptions:c,schema:tu}))?h:{};null!=o&&y.push({type:"unsupported-setting",setting:"topK"}),null!=s&&y.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=a&&y.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=i&&y.push({type:"unsupported-setting",setting:"stopSequences"});let{messages:b,warnings:_}=function(e){let t=[];for(let{role:n,content:r}of e)switch(n){case"system":t.push({role:"system",content:r});break;case"user":if(1===r.length&&"text"===r[0].type){t.push({role:"user",content:r[0].text});break}t.push({role:"user",content:r.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${(0,g.convertToBase64)(e.data)}`}}}throw new g.UnsupportedFunctionalityError({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e="",n=[];for(let t of r)switch(t.type){case"text":e+=t.text;break;case"tool-call":n.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.input)}})}t.push({role:"assistant",content:e,tool_calls:n.length>0?n:void 0});break}case"tool":for(let e of r){let n,r=e.output;switch(r.type){case"text":case"error-text":n=r.value;break;case"content":case"json":case"error-json":n=JSON.stringify(r.value)}t.push({role:"tool",tool_call_id:e.toolCallId,content:n})}break;default:throw Error(`Unsupported role: ${n}`)}return{messages:t,warnings:[]}}(e);y.push(..._);let{tools:z,toolChoice:w,toolWarnings:k}=function({tools:e,toolChoice:t}){e=(null==e?void 0:e.length)?e:void 0;let n=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let r=[];for(let t of e)"provider-defined"===t.type?n.push({type:"unsupported-tool",tool:t}):r.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema}});if(null==t)return{tools:r,toolChoice:void 0,toolWarnings:n};let o=t.type;switch(o){case"auto":case"none":return{tools:r,toolChoice:o,toolWarnings:n};case"required":return{tools:r,toolChoice:"required",toolWarnings:n};case"tool":return{tools:r,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:throw new g.UnsupportedFunctionalityError({functionality:`tool choice type: ${o}`})}}({tools:p,toolChoice:d});return y.push(...k),{args:{model:this.modelId,max_tokens:t,temperature:n,top_p:r,seed:l,reasoning_effort:v.reasoningEffort,parallel_function_calling:v.parallel_function_calling,response_format:(null==u?void 0:u.type)==="json"?null!=u.schema?{type:"json_schema",json_schema:{name:null!=(m=u.name)?m:"response",schema:u.schema,strict:!0}}:{type:"json_object"}:void 0,search_parameters:v.searchParameters?{mode:v.searchParameters.mode,return_citations:v.searchParameters.returnCitations,from_date:v.searchParameters.fromDate,to_date:v.searchParameters.toDate,max_search_results:v.searchParameters.maxSearchResults,sources:null==(f=v.searchParameters.sources)?void 0:f.map(e=>{var t;return{type:e.type,..."web"===e.type&&{country:e.country,excluded_websites:e.excludedWebsites,allowed_websites:e.allowedWebsites,safe_search:e.safeSearch},..."x"===e.type&&{excluded_x_handles:e.excludedXHandles,included_x_handles:null!=(t=e.includedXHandles)?t:e.xHandles,post_favorite_count:e.postFavoriteCount,post_view_count:e.postViewCount},..."news"===e.type&&{country:e.country,excluded_websites:e.excludedWebsites,safe_search:e.safeSearch},..."rss"===e.type&&{links:e.links}}})}:void 0,messages:b,tools:z,tool_choice:w},warnings:y}}async doGenerate(e){var t,n,r;let{args:o,warnings:s}=await this.getArgs(e),{responseHeaders:a,value:i,rawValue:l}=await (0,g.postJsonToApi)({url:`${null!=(t=this.config.baseURL)?t:"https://api.x.ai/v1"}/chat/completions`,headers:(0,g.combineHeaders)(this.config.headers(),e.headers),body:o,failedResponseHandler:tp,successfulResponseHandler:(0,g.createJsonResponseHandler)(tm),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=i.choices[0],c=[];if(null!=u.message.content&&u.message.content.length>0){let e=u.message.content,t=o.messages[o.messages.length-1];(null==t?void 0:t.role)==="assistant"&&e===t.content&&(e=""),e.length>0&&c.push({type:"text",text:e})}if(null!=u.message.reasoning_content&&u.message.reasoning_content.length>0&&c.push({type:"reasoning",text:u.message.reasoning_content}),null!=u.message.tool_calls)for(let e of u.message.tool_calls)c.push({type:"tool-call",toolCallId:e.id,toolName:e.function.name,input:e.function.arguments});if(null!=i.citations)for(let e of i.citations)c.push({type:"source",sourceType:"url",id:this.config.generateId(),url:e});return{content:c,finishReason:tr(u.finish_reason),usage:{inputTokens:i.usage.prompt_tokens,outputTokens:i.usage.completion_tokens,totalTokens:i.usage.total_tokens,reasoningTokens:null!=(r=null==(n=i.usage.completion_tokens_details)?void 0:n.reasoning_tokens)?r:void 0},request:{body:o},response:{...tn(i),headers:a,body:l},warnings:s}}async doStream(e){var t;let{args:n,warnings:r}=await this.getArgs(e),o={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:s,value:a}=await (0,g.postJsonToApi)({url:`${null!=(t=this.config.baseURL)?t:"https://api.x.ai/v1"}/chat/completions`,headers:(0,g.combineHeaders)(this.config.headers(),e.headers),body:o,failedResponseHandler:tp,successfulResponseHandler:(0,g.createEventSourceResponseHandler)(tg),abortSignal:e.abortSignal,fetch:this.config.fetch}),i="unknown",l={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},u=!0,c={},p={},d=this;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:r})},transform(t,n){var r,s;if(e.includeRawChunks&&n.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return void n.enqueue({type:"error",error:t.error});let a=t.value;if(u&&(n.enqueue({type:"response-metadata",...tn(a)}),u=!1),null!=a.citations)for(let e of a.citations)n.enqueue({type:"source",sourceType:"url",id:d.config.generateId(),url:e});null!=a.usage&&(l.inputTokens=a.usage.prompt_tokens,l.outputTokens=a.usage.completion_tokens,l.totalTokens=a.usage.total_tokens,l.reasoningTokens=null!=(s=null==(r=a.usage.completion_tokens_details)?void 0:r.reasoning_tokens)?s:void 0);let h=a.choices[0];if((null==h?void 0:h.finish_reason)!=null&&(i=tr(h.finish_reason)),(null==h?void 0:h.delta)==null)return;let m=h.delta,g=h.index;if(null!=m.content&&m.content.length>0){let e=m.content,t=o.messages[o.messages.length-1];if((null==t?void 0:t.role)==="assistant"&&e===t.content)return;let r=`text-${a.id||g}`;null==c[r]&&(c[r]={type:"text"},n.enqueue({type:"text-start",id:r})),n.enqueue({type:"text-delta",id:r,delta:e})}if(null!=m.reasoning_content&&m.reasoning_content.length>0){let e=`reasoning-${a.id||g}`;if(p[e]===m.reasoning_content)return;p[e]=m.reasoning_content,null==c[e]&&(c[e]={type:"reasoning"},n.enqueue({type:"reasoning-start",id:e})),n.enqueue({type:"reasoning-delta",id:e,delta:m.reasoning_content})}if(null!=m.tool_calls)for(let e of m.tool_calls){let t=e.id;n.enqueue({type:"tool-input-start",id:t,toolName:e.function.name}),n.enqueue({type:"tool-input-delta",id:t,delta:e.function.arguments}),n.enqueue({type:"tool-input-end",id:t}),n.enqueue({type:"tool-call",toolCallId:t,toolName:e.function.name,input:e.function.arguments})}},flush(e){for(let[t,n]of Object.entries(c))e.enqueue({type:"text"===n.type?"text-end":"reasoning-end",id:t});e.enqueue({type:"finish",finishReason:i,usage:l})}})),request:{body:o},response:{headers:s}}}},th=v.z.object({prompt_tokens:v.z.number(),completion_tokens:v.z.number(),total_tokens:v.z.number(),completion_tokens_details:v.z.object({reasoning_tokens:v.z.number().nullish()}).nullish()}),tm=v.z.object({id:v.z.string().nullish(),created:v.z.number().nullish(),model:v.z.string().nullish(),choices:v.z.array(v.z.object({message:v.z.object({role:v.z.literal("assistant"),content:v.z.string().nullish(),reasoning_content:v.z.string().nullish(),tool_calls:v.z.array(v.z.object({id:v.z.string(),type:v.z.literal("function"),function:v.z.object({name:v.z.string(),arguments:v.z.string()})})).nullish()}),index:v.z.number(),finish_reason:v.z.string().nullish()})),object:v.z.literal("chat.completion"),usage:th,citations:v.z.array(v.z.string().url()).nullish()}),tg=v.z.object({id:v.z.string().nullish(),created:v.z.number().nullish(),model:v.z.string().nullish(),choices:v.z.array(v.z.object({delta:v.z.object({role:v.z.enum(["assistant"]).optional(),content:v.z.string().nullish(),reasoning_content:v.z.string().nullish(),tool_calls:v.z.array(v.z.object({id:v.z.string(),type:v.z.literal("function"),function:v.z.object({name:v.z.string(),arguments:v.z.string()})})).nullish()}),finish_reason:v.z.string().nullish(),index:v.z.number()})),usage:th.nullish(),citations:v.z.array(v.z.string().url()).nullish()}),tf={errorSchema:tc,errorToMessage:e=>e.error.message};function ty(e={}){var t;let n=(0,g.withoutTrailingSlash)(null!=(t=e.baseURL)?t:"https://api.x.ai/v1"),r=()=>(0,g.withUserAgentSuffix)({Authorization:`Bearer ${(0,g.loadApiKey)({apiKey:e.apiKey,environmentVariableName:"XAI_API_KEY",description:"xAI API key"})}`,...e.headers},"ai-sdk/xai/2.0.33"),o=t=>new td(t,{provider:"xai.chat",baseURL:n,headers:r,generateId:g.generateId,fetch:e.fetch}),s=t=>new g.OpenAICompatibleImageModel(t,{provider:"xai.image",url:({path:e})=>`${n}${e}`,headers:r,fetch:e.fetch,errorStructure:tf}),a=e=>o(e);return a.languageModel=o,a.chat=o,a.textEmbeddingModel=e=>{throw new g.NoSuchModelError({modelId:e,modelType:"textEmbeddingModel"})},a.imageModel=s,a.image=s,a}ty();var tv=Object.defineProperty,tb=Object.defineProperties,t_=Object.getOwnPropertyDescriptors,tz=Object.getOwnPropertySymbols,tw=Object.prototype.hasOwnProperty,tk=Object.prototype.propertyIsEnumerable,tx=(e,t,n)=>t in e?tv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tT=(e,t)=>{for(var n in t||(t={}))tw.call(t,n)&&tx(e,n,t[n]);if(tz)for(var n of tz(t))tk.call(t,n)&&tx(e,n,t[n]);return e},tj="vercel.ai.error",tP=Symbol.for(tj),tI=class e extends Error{constructor({name:e,message:t,cause:n}){super(t),this[o]=!0,this.name=e,this.cause=n}static isInstance(t){return e.hasMarker(t,tj)}static hasMarker(e,t){let n=Symbol.for(t);return null!=e&&"object"==typeof e&&n in e&&"boolean"==typeof e[n]&&!0===e[n]}};o=tP;var tE=tI,tS="AI_APICallError",tA=`vercel.ai.error.${tS}`,t$=Symbol.for(tA),tO=class extends tE{constructor({message:e,url:t,requestBodyValues:n,statusCode:r,responseHeaders:o,responseBody:a,cause:i,isRetryable:l=null!=r&&(408===r||409===r||429===r||r>=500),data:u}){super({name:tS,message:e,cause:i}),this[s]=!0,this.url=t,this.requestBodyValues=n,this.statusCode=r,this.responseHeaders=o,this.responseBody=a,this.isRetryable=l,this.data=u}static isInstance(e){return tE.hasMarker(e,tA)}};s=t$;var tq="AI_EmptyResponseBodyError",tC=`vercel.ai.error.${tq}`,tN=Symbol.for(tC),tR=class extends tE{constructor({message:e="Empty response body"}={}){super({name:tq,message:e}),this[a]=!0}static isInstance(e){return tE.hasMarker(e,tC)}};function tZ(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}a=tN;var tM="AI_InvalidArgumentError",tV=`vercel.ai.error.${tM}`,tF=Symbol.for(tV),tK=class extends tE{constructor({message:e,cause:t,argument:n}){super({name:tM,message:e,cause:t}),this[i]=!0,this.argument=n}static isInstance(e){return tE.hasMarker(e,tV)}};i=tF;var tL="AI_InvalidPromptError",tU=`vercel.ai.error.${tL}`,tB=Symbol.for(tU),tH=class extends tE{constructor({prompt:e,message:t,cause:n}){super({name:tL,message:`Invalid prompt: ${t}`,cause:n}),this[l]=!0,this.prompt=e}static isInstance(e){return tE.hasMarker(e,tU)}};l=tB;var tJ="AI_InvalidResponseDataError",tD=`vercel.ai.error.${tJ}`,tW=Symbol.for(tD),tG=class extends tE{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:tJ,message:t}),this[u]=!0,this.data=e}static isInstance(e){return tE.hasMarker(e,tD)}};u=tW;var tY="AI_JSONParseError",tX=`vercel.ai.error.${tY}`,tQ=Symbol.for(tX),t0=class extends tE{constructor({text:e,cause:t}){super({name:tY,message:`JSON parsing failed: Text: ${e}.
Error message: ${tZ(t)}`,cause:t}),this[c]=!0,this.text=e}static isInstance(e){return tE.hasMarker(e,tX)}};c=tQ;var t1="AI_LoadAPIKeyError",t9=`vercel.ai.error.${t1}`,t4=Symbol.for(t9),t2=class extends tE{constructor({message:e}){super({name:t1,message:e}),this[p]=!0}static isInstance(e){return tE.hasMarker(e,t9)}};p=t4;var t6="AI_NoContentGeneratedError",t3=`vercel.ai.error.${t6}`,t5=Symbol.for(t3),t7=class extends tE{constructor({message:e="No content generated."}={}){super({name:t6,message:e}),this[d]=!0}static isInstance(e){return tE.hasMarker(e,t3)}};d=t5;var t8="AI_TypeValidationError",ne=`vercel.ai.error.${t8}`,nt=Symbol.for(ne),nn=class e extends tE{constructor({value:e,cause:t}){super({name:t8,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${tZ(t)}`,cause:t}),this[h]=!0,this.value=e}static isInstance(e){return tE.hasMarker(e,ne)}static wrap({value:t,cause:n}){return e.isInstance(n)&&n.value===t?n:new e({value:t,cause:n})}};h=nt;var nr="AI_UnsupportedFunctionalityError",no=`vercel.ai.error.${nr}`,ns=Symbol.for(no),na=class extends tE{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:nr,message:t}),this[m]=!0,this.functionality=e}static isInstance(e){return tE.hasMarker(e,no)}};m=ns;var ni=class extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}};function nl(e){}var nu=class extends TransformStream{constructor({onError:e,onRetry:t,onComment:n}={}){let r;super({start(o){r=function(e){if("function"==typeof e)throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:t=nl,onError:n=nl,onRetry:r=nl,onComment:o}=e,s="",a=!0,i,l="",u="";function c(e){if(""===e)return void(l.length>0&&t({id:i,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",u="");if(e.startsWith(":")){o&&o(e.slice(e.startsWith(": ")?2:1));return}let n=e.indexOf(":");if(-1!==n){let t=e.slice(0,n),r=" "===e[n+1]?2:1;p(t,e.slice(n+r),e);return}p(e,"",e)}function p(e,t,o){switch(e){case"event":u=t;break;case"data":l=`${l}${t}
`;break;case"id":i=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?r(parseInt(t,10)):n(new ni(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:o}));break;default:n(new ni(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:"unknown-field",field:e,value:t,line:o}))}}return{feed:function(e){let t=a?e.replace(/^\xEF\xBB\xBF/,""):e,[n,r]=function(e){let t=[],n="",r=0;for(;r<e.length;){let o=e.indexOf("\r",r),s=e.indexOf(`
`,r),a=-1;if(-1!==o&&-1!==s?a=Math.min(o,s):-1!==o?a=o:-1!==s&&(a=s),-1===a){n=e.slice(r);break}{let n=e.slice(r,a);t.push(n),"\r"===e[(r=a+1)-1]&&e[r]===`
`&&r++}}return[t,n]}(`${s}${t}`);for(let e of n)c(e);s=r,a=!1},reset:function(e={}){s&&e.consume&&c(s),a=!0,i=void 0,l="",u="",s=""}}}({onEvent:e=>{o.enqueue(e)},onError(t){"terminate"===e?o.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:n})},transform(e){r.feed(e)}})}};function nc(...e){return e.reduce((e,t)=>tT(tT({},e),null!=t?t:{}),{})}function np(e){return Object.fromEntries([...e.headers])}var nd=(({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let o=()=>{let e=n.length,r=Array(t);for(let o=0;o<t;o++)r[o]=n[Math.random()*e|0];return r.join("")};if(null==e)return o;if(n.includes(r))throw new tK({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${n}".`});return()=>`${e}${r}${o()}`})();function nh(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var nm=["fetch failed","failed to fetch"],ng=/"__proto__"\s*:/,nf=/"constructor"\s*:/;function ny(e){let{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{let t;return t=JSON.parse(e),null===t||"object"!=typeof t||!1===ng.test(e)&&!1===nf.test(e)?t:function(e){let t=[e];for(;t.length;){let e=t;for(let n of(t=[],e)){if(Object.prototype.hasOwnProperty.call(n,"__proto__")||Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let e in n){let r=n[e];r&&"object"==typeof r&&t.push(r)}}}return e}(t)}finally{Error.stackTraceLimit=t}}var nv=Symbol.for("vercel.ai.validator");async function nb({value:e,schema:t}){let n=await n_({value:e,schema:t});if(!n.success)throw nn.wrap({value:e,cause:n.error});return n.value}async function n_({value:e,schema:t}){var n;let r="object"==typeof t&&null!==t&&nv in t&&!0===t[nv]&&"validate"in t?t:(n=t,{[nv]:!0,validate:async e=>{let t=await n["~standard"].validate(e);return null==t.issues?{success:!0,value:t.value}:{success:!1,error:new nn({value:e,cause:t.issues})}}});try{if(null==r.validate)return{success:!0,value:e,rawValue:e};let t=await r.validate(e);if(t.success)return{success:!0,value:t.value,rawValue:e};return{success:!1,error:nn.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:nn.wrap({value:e,cause:t}),rawValue:e}}}async function nz({text:e,schema:t}){try{let n=ny(e);if(null==t)return n;return nb({value:n,schema:t})}catch(t){if(t0.isInstance(t)||nn.isInstance(t))throw t;throw new t0({text:e,cause:t})}}async function nw({text:e,schema:t}){try{let n=ny(e);if(null==t)return{success:!0,value:n,rawValue:n};return await n_({value:n,schema:t})}catch(t){return{success:!1,error:t0.isInstance(t)?t:new t0({text:e,cause:t}),rawValue:void 0}}}function nk(e){try{return ny(e),!0}catch(e){return!1}}var nx=()=>globalThis.fetch,nT=async({url:e,headers:t,body:n,failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a})=>nj({url:e,headers:tT({"Content-Type":"application/json"},t),body:{content:JSON.stringify(n),values:n},failedResponseHandler:r,successfulResponseHandler:o,abortSignal:s,fetch:a}),nj=async({url:e,headers:t={},body:n,successfulResponseHandler:r,failedResponseHandler:o,abortSignal:s,fetch:a=nx()})=>{try{let i=await a(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:n.content,signal:s}),l=np(i);if(!i.ok){let t;try{t=await o({response:i,url:e,requestBodyValues:n.values})}catch(t){if(nh(t)||tO.isInstance(t))throw t;throw new tO({message:"Failed to process error response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}throw t.value}try{return await r({response:i,url:e,requestBodyValues:n.values})}catch(t){if(t instanceof Error&&(nh(t)||tO.isInstance(t)))throw t;throw new tO({message:"Failed to process successful response",cause:t,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:n.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:n}){if(nh(e))return e;if(e instanceof TypeError&&nm.includes(e.message.toLowerCase())){let r=e.cause;if(null!=r)return new tO({message:`Cannot connect to API: ${r.message}`,cause:r,url:t,requestBodyValues:n,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:n.values})}},nP=e=>async({response:t})=>{let n=np(t);if(null==t.body)throw new tR({});return{responseHeaders:n,value:function({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new nu).pipeThrough(new TransformStream({async transform({data:e},n){"[DONE]"!==e&&n.enqueue(await nw({text:e,schema:t}))}}))}({stream:t.body,schema:e})}},nI=e=>async({response:t,url:n,requestBodyValues:r})=>{let o=await t.text(),s=await nw({text:o,schema:e}),a=np(t);if(!s.success)throw new tO({message:"Invalid JSON response",cause:s.error,statusCode:t.status,responseHeaders:a,responseBody:o,url:n,requestBodyValues:r});return{responseHeaders:a,value:s.value,rawValue:s.rawValue}},{btoa:nE}=globalThis;function nS(e){return null!=e}var nA=((r=nA||{}).Unknown="unknown",r.OpenAIResponsesV1="openai-responses-v1",r.XAIResponsesV1="xai-responses-v1",r.AnthropicClaudeV1="anthropic-claude-v1",r),n$=v.z.object({id:v.z.string().nullish(),format:v.z.nativeEnum(nA).nullish(),index:v.z.number().optional()}).passthrough(),nO=v.z.object({type:v.z.literal("reasoning.summary"),summary:v.z.string()}).extend(n$.shape),nq=v.z.object({type:v.z.literal("reasoning.encrypted"),data:v.z.string()}).extend(n$.shape),nC=v.z.object({type:v.z.literal("reasoning.text"),text:v.z.string().nullish(),signature:v.z.string().nullish()}).extend(n$.shape),nN=v.z.union([nO,nq,nC]),nR=v.z.union([nN,v.z.unknown().transform(()=>null)]),nZ=v.z.array(nR).transform(e=>e.filter(e=>!!e));v.z.union([v.z.object({delta:v.z.object({reasoning_details:v.z.array(nR)})}).transform(e=>e.delta.reasoning_details.filter(nS)),v.z.object({message:v.z.object({reasoning_details:v.z.array(nR)})}).transform(e=>e.message.reasoning_details.filter(nS)),v.z.object({text:v.z.string(),reasoning_details:v.z.array(nR)}).transform(e=>e.reasoning_details.filter(nS))]);var nM=v.z.object({error:v.z.object({code:v.z.union([v.z.string(),v.z.number()]).nullable().optional().default(null),message:v.z.string(),type:v.z.string().nullable().optional().default(null),param:v.z.any().nullable().optional().default(null)}).passthrough()}).passthrough(),nV=(({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:r,url:o,requestBodyValues:s})=>{let a=await r.text(),i=np(r);if(""===a.trim())return{responseHeaders:i,value:new tO({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,isRetryable:null==n?void 0:n(r)})};try{let l=await nz({text:a,schema:e});return{responseHeaders:i,value:new tO({message:t(l),url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,data:l,isRetryable:null==n?void 0:n(r,l)})}}catch(e){return{responseHeaders:i,value:new tO({message:r.statusText,url:o,requestBodyValues:s,statusCode:r.status,responseHeaders:i,responseBody:a,isRetryable:null==n?void 0:n(r)})}}})({errorSchema:nM,errorToMessage:e=>e.error.message}),nF=v.z.object({provider:v.z.string(),reasoning_details:v.z.array(nN).optional(),usage:v.z.object({promptTokens:v.z.number(),promptTokensDetails:v.z.object({cachedTokens:v.z.number()}).passthrough().optional(),completionTokens:v.z.number(),completionTokensDetails:v.z.object({reasoningTokens:v.z.number()}).passthrough().optional(),totalTokens:v.z.number(),cost:v.z.number().optional(),costDetails:v.z.object({upstreamInferenceCost:v.z.number()}).passthrough()}).passthrough()}).passthrough(),nK=v.z.object({openrouter:v.z.object({reasoning_details:v.z.array(nN).optional()}).optional()}).optional();function nL(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}function nU({url:e,protocols:t}){try{let n=new URL(e);return t.has(n.protocol)}catch(e){return!1}}function nB({part:e,defaultMediaType:t}){var n,r;if(e.data instanceof Uint8Array){let r=function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return nE(t)}(e.data);return`data:${null!=(n=e.mediaType)?n:t};base64,${r}`}let o=e.data.toString();return nU({url:o,protocols:new Set(["http:","https:"])})||o.startsWith("data:")?o:`data:${null!=(r=e.mediaType)?r:t};base64,${o}`}function nH(e,t){var n;let r=e.match(/^data:([^;]+)/);return r&&null!=(n=r[1])?n:t}function nJ(e){let t=e.match(/^data:[^;]*;base64,(.+)$/);return t?t[1]:e}function nD(e){var t,n,r;let o=null==e?void 0:e.anthropic,s=null==e?void 0:e.openrouter;return null!=(r=null!=(n=null!=(t=null==s?void 0:s.cacheControl)?t:null==s?void 0:s.cache_control)?n:null==o?void 0:o.cacheControl)?r:null==o?void 0:o.cache_control}v.z.union([v.z.literal("auto"),v.z.literal("none"),v.z.literal("required"),v.z.object({type:v.z.literal("function"),function:v.z.object({name:v.z.string()})})]);var nW=v.z.object({type:v.z.literal("image_url"),image_url:v.z.object({url:v.z.string()}).passthrough()}).passthrough(),nG=v.z.union([nW,v.z.unknown().transform(()=>null)]),nY=v.z.array(nG).transform(e=>e.filter(e=>!!e)),nX=v.z.object({id:v.z.string().optional(),model:v.z.string().optional(),provider:v.z.string().optional(),usage:v.z.object({prompt_tokens:v.z.number(),prompt_tokens_details:v.z.object({cached_tokens:v.z.number()}).passthrough().nullish(),completion_tokens:v.z.number(),completion_tokens_details:v.z.object({reasoning_tokens:v.z.number()}).passthrough().nullish(),total_tokens:v.z.number(),cost:v.z.number().optional(),cost_details:v.z.object({upstream_inference_cost:v.z.number().nullish()}).passthrough().nullish()}).passthrough().nullish()}).passthrough(),nQ=v.z.union([nX.extend({choices:v.z.array(v.z.object({message:v.z.object({role:v.z.literal("assistant"),content:v.z.string().nullable().optional(),reasoning:v.z.string().nullable().optional(),reasoning_details:nZ.nullish(),images:nY.nullish(),tool_calls:v.z.array(v.z.object({id:v.z.string().optional().nullable(),type:v.z.literal("function"),function:v.z.object({name:v.z.string(),arguments:v.z.string()}).passthrough()}).passthrough()).optional(),annotations:v.z.array(v.z.union([v.z.object({type:v.z.literal("url_citation"),url_citation:v.z.object({end_index:v.z.number(),start_index:v.z.number(),title:v.z.string(),url:v.z.string(),content:v.z.string().optional()}).passthrough()}).passthrough(),v.z.object({type:v.z.literal("file_annotation"),file_annotation:v.z.object({file_id:v.z.string(),quote:v.z.string().optional()}).passthrough()}).passthrough(),v.z.object({type:v.z.literal("file"),file:v.z.object({hash:v.z.string(),name:v.z.string(),content:v.z.array(v.z.object({type:v.z.string(),text:v.z.string()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough(),index:v.z.number().nullish(),logprobs:v.z.object({content:v.z.array(v.z.object({token:v.z.string(),logprob:v.z.number(),top_logprobs:v.z.array(v.z.object({token:v.z.string(),logprob:v.z.number()}).passthrough())}).passthrough()).nullable()}).passthrough().nullable().optional(),finish_reason:v.z.string().optional().nullable()}).passthrough())}),nM.extend({user_id:v.z.string().optional()})]),n0=v.z.union([nX.extend({choices:v.z.array(v.z.object({delta:v.z.object({role:v.z.enum(["assistant"]).optional(),content:v.z.string().nullish(),reasoning:v.z.string().nullish().optional(),reasoning_details:nZ.nullish(),images:nY.nullish(),tool_calls:v.z.array(v.z.object({index:v.z.number().nullish(),id:v.z.string().nullish(),type:v.z.literal("function").optional(),function:v.z.object({name:v.z.string().nullish(),arguments:v.z.string().nullish()}).passthrough()}).passthrough()).nullish(),annotations:v.z.array(v.z.union([v.z.object({type:v.z.literal("url_citation"),url_citation:v.z.object({end_index:v.z.number(),start_index:v.z.number(),title:v.z.string(),url:v.z.string(),content:v.z.string().optional()}).passthrough()}).passthrough(),v.z.object({type:v.z.literal("file_annotation"),file_annotation:v.z.object({file_id:v.z.string(),quote:v.z.string().optional()}).passthrough()}).passthrough(),v.z.object({type:v.z.literal("file"),file:v.z.object({hash:v.z.string(),name:v.z.string(),content:v.z.array(v.z.object({type:v.z.string(),text:v.z.string()}).passthrough()).optional()}).passthrough()}).passthrough()])).nullish()}).passthrough().nullish(),logprobs:v.z.object({content:v.z.array(v.z.object({token:v.z.string(),logprob:v.z.number(),top_logprobs:v.z.array(v.z.object({token:v.z.string(),logprob:v.z.number()}).passthrough())}).passthrough()).nullable()}).passthrough().nullish(),finish_reason:v.z.string().nullable().optional(),index:v.z.number().nullish()}).passthrough())}),nM]),n1=class{constructor(e,t,n){this.specificationVersion="v2",this.provider="openrouter",this.defaultObjectGenerationMode="tool",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.modelId=e,this.settings=t,this.config=n}getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,frequencyPenalty:o,presencePenalty:s,seed:a,stopSequences:i,responseFormat:l,topK:u,tools:c,toolChoice:p}){var d;let h=tT(tT({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:t,temperature:n,top_p:r,frequency_penalty:o,presence_penalty:s,seed:a,stop:i,response_format:l,top_k:u,messages:function(e){var t,n,r,o,s,a;let i=[];for(let{role:l,content:u,providerOptions:c}of e)switch(l){case"system":i.push({role:"system",content:u,cache_control:nD(c)});break;case"user":{if(1===u.length&&(null==(t=u[0])?void 0:t.type)==="text"){let e=null!=(n=nD(c))?n:nD(u[0].providerOptions),t=e?[{type:"text",text:u[0].text,cache_control:e}]:u[0].text;i.push({role:"user",content:t});break}let e=nD(c),r=u.map(t=>{var n,r,o,s,a,i;let l=null!=(n=nD(t.providerOptions))?n:e;switch(t.type){case"text":return{type:"text",text:t.text,cache_control:l};case"file":{if(null==(r=t.mediaType)?void 0:r.startsWith("image/"))return{type:"image_url",image_url:{url:nB({part:t,defaultMediaType:"image/jpeg"})},cache_control:l};let e=String(null!=(i=null!=(a=null==(s=null==(o=t.providerOptions)?void 0:o.openrouter)?void 0:s.filename)?a:t.filename)?i:""),n=nB({part:t,defaultMediaType:"application/pdf"});if(nU({url:n,protocols:new Set(["http:","https:"])}))return{type:"file",file:{filename:e,file_data:n}};return{type:"file",file:{filename:e,file_data:n},cache_control:l}}default:return{type:"text",text:"",cache_control:l}}});i.push({role:"user",content:r});break}case"assistant":{let e="",t="",n=[];for(let r of u)switch(r.type){case"text":e+=r.text;break;case"tool-call":n.push({id:r.toolCallId,type:"function",function:{name:r.toolName,arguments:JSON.stringify(r.input)}});break;case"reasoning":t+=r.text}let s=nK.safeParse(c),a=s.success?null==(o=null==(r=s.data)?void 0:r.openrouter)?void 0:o.reasoning_details:void 0;i.push({role:"assistant",content:e,tool_calls:n.length>0?n:void 0,reasoning:t||void 0,reasoning_details:a&&Array.isArray(a)&&a.length>0?a:void 0,cache_control:nD(c)});break}case"tool":for(let e of u){let t="text"===(a=e).output.type?a.output.value:JSON.stringify(a.output.value);i.push({role:"tool",tool_call_id:e.toolCallId,content:t,cache_control:null!=(s=nD(c))?s:nD(e.providerOptions)})}}return i}(e),include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning,usage:this.settings.usage,plugins:this.settings.plugins,web_search_options:this.settings.web_search_options,provider:this.settings.provider},this.config.extraBody),this.settings.extraBody);if((null==l?void 0:l.type)==="json"&&null!=l.schema)return tb(tT({},h),t_({response_format:{type:"json_schema",json_schema:tT({schema:l.schema,strict:!0,name:null!=(d=l.name)?d:"response"},l.description&&{description:l.description})}}));if(c&&c.length>0){let e=c.filter(e=>"function"===e.type).map(e=>({type:"function",function:{name:e.name,description:e.description,parameters:e.inputSchema}}));return tb(tT({},h),t_({tools:e,tool_choice:p?function(e){switch(e.type){case"auto":case"none":case"required":return e.type;case"tool":return{type:"function",function:{name:e.toolName}};default:throw new tK({argument:"toolChoice",message:`Invalid tool choice type: ${JSON.stringify(e)}`})}}(p):void 0}))}return h}async doGenerate(e){var t,n,r,o,s,a,i,l,u,c,p,d,h,m,g,f,y,v,b,_,z,w,k,x,T;let j=(e.providerOptions||{}).openrouter||{},P=tT(tT({},this.getArgs(e)),j),{value:I,responseHeaders:E}=await nT({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:nc(this.config.headers(),e.headers),body:P,failedResponseHandler:nV,successfulResponseHandler:nI(nQ),abortSignal:e.abortSignal,fetch:this.config.fetch});if("error"in I){let e=I.error;throw new tO({message:e.message,url:this.config.url({path:"/chat/completions",modelId:this.modelId}),requestBodyValues:P,statusCode:200,responseHeaders:E,data:e})}let S=I.choices[0];if(!S)throw new t7({message:"No choice in response"});let A=I.usage?{inputTokens:null!=(t=I.usage.prompt_tokens)?t:0,outputTokens:null!=(n=I.usage.completion_tokens)?n:0,totalTokens:(null!=(r=I.usage.prompt_tokens)?r:0)+(null!=(o=I.usage.completion_tokens)?o:0),reasoningTokens:null!=(a=null==(s=I.usage.completion_tokens_details)?void 0:s.reasoning_tokens)?a:0,cachedInputTokens:null!=(l=null==(i=I.usage.prompt_tokens_details)?void 0:i.cached_tokens)?l:0}:{inputTokens:0,outputTokens:0,totalTokens:0,reasoningTokens:0,cachedInputTokens:0},$=null!=(u=S.message.reasoning_details)?u:[],O=$.length>0?$.map(e=>{switch(e.type){case"reasoning.text":if(e.text)return{type:"reasoning",text:e.text};break;case"reasoning.summary":if(e.summary)return{type:"reasoning",text:e.summary};break;case"reasoning.encrypted":if(e.data)return{type:"reasoning",text:"[REDACTED]"}}return null}).filter(e=>null!==e):S.message.reasoning?[{type:"reasoning",text:S.message.reasoning}]:[],q=[];if(q.push(...O),S.message.content&&q.push({type:"text",text:S.message.content}),S.message.tool_calls)for(let e of S.message.tool_calls)q.push({type:"tool-call",toolCallId:null!=(c=e.id)?c:nd(),toolName:e.function.name,input:e.function.arguments});if(S.message.images)for(let e of S.message.images)q.push({type:"file",mediaType:nH(e.image_url.url,"image/jpeg"),data:nJ(e.image_url.url)});if(S.message.annotations)for(let e of S.message.annotations)"url_citation"===e.type&&q.push({type:"source",sourceType:"url",id:e.url_citation.url,url:e.url_citation.url,title:e.url_citation.title,providerMetadata:{openrouter:{content:e.url_citation.content||""}}});return{content:q,finishReason:nL(S.finish_reason),usage:A,warnings:[],providerMetadata:{openrouter:nF.parse({provider:null!=(p=I.provider)?p:"",reasoning_details:null!=(d=S.message.reasoning_details)?d:[],usage:{promptTokens:null!=(h=A.inputTokens)?h:0,completionTokens:null!=(m=A.outputTokens)?m:0,totalTokens:null!=(g=A.totalTokens)?g:0,cost:null==(f=I.usage)?void 0:f.cost,promptTokensDetails:{cachedTokens:null!=(b=null==(v=null==(y=I.usage)?void 0:y.prompt_tokens_details)?void 0:v.cached_tokens)?b:0},completionTokensDetails:{reasoningTokens:null!=(w=null==(z=null==(_=I.usage)?void 0:_.completion_tokens_details)?void 0:z.reasoning_tokens)?w:0},costDetails:{upstreamInferenceCost:null!=(T=null==(x=null==(k=I.usage)?void 0:k.cost_details)?void 0:x.upstream_inference_cost)?T:0}}})},request:{body:P},response:{id:I.id,modelId:I.model,headers:E}}}async doStream(e){var t;let n,r,o,s,a=(e.providerOptions||{}).openrouter||{},i=tT(tT({},this.getArgs(e)),a),{value:l,responseHeaders:u}=await nT({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:nc(this.config.headers(),e.headers),body:tb(tT({},i),t_({stream:!0,stream_options:"strict"===this.config.compatibility?tT({include_usage:!0},(null==(t=this.settings.usage)?void 0:t.include)?{include_usage:!0}:{}):void 0})),failedResponseHandler:nV,successfulResponseHandler:nP(n0),abortSignal:e.abortSignal,fetch:this.config.fetch}),c=[],p="other",d={inputTokens:NaN,outputTokens:NaN,totalTokens:NaN,reasoningTokens:NaN,cachedInputTokens:NaN},h={},m=[],g=!1,f=!1;return{stream:l.pipeThrough(new TransformStream({transform(e,t){var a,i,l,u,y,v,b,_,z,w,k,x,T,j;if(!e.success){p="error",t.enqueue({type:"error",error:e.error});return}let P=e.value;if("error"in P){p="error",t.enqueue({type:"error",error:P.error});return}if(P.provider&&(s=P.provider),P.id&&(o=P.id,t.enqueue({type:"response-metadata",id:P.id})),P.model&&t.enqueue({type:"response-metadata",modelId:P.model}),null!=P.usage){if(d.inputTokens=P.usage.prompt_tokens,d.outputTokens=P.usage.completion_tokens,d.totalTokens=P.usage.prompt_tokens+P.usage.completion_tokens,h.promptTokens=P.usage.prompt_tokens,P.usage.prompt_tokens_details){let e=null!=(a=P.usage.prompt_tokens_details.cached_tokens)?a:0;d.cachedInputTokens=e,h.promptTokensDetails={cachedTokens:e}}if(h.completionTokens=P.usage.completion_tokens,P.usage.completion_tokens_details){let e=null!=(i=P.usage.completion_tokens_details.reasoning_tokens)?i:0;d.reasoningTokens=e,h.completionTokensDetails={reasoningTokens:e}}h.cost=P.usage.cost,h.totalTokens=P.usage.total_tokens}let I=P.choices[0];if((null==I?void 0:I.finish_reason)!=null&&(p=nL(I.finish_reason)),(null==I?void 0:I.delta)==null)return;let E=I.delta,S=e=>{f||(r=o||nd(),t.enqueue({type:"reasoning-start",id:r}),f=!0),t.enqueue({type:"reasoning-delta",delta:e,id:r||nd()})};if(E.reasoning_details&&E.reasoning_details.length>0)for(let e of(m.push(...E.reasoning_details),E.reasoning_details))switch(e.type){case"reasoning.text":e.text&&S(e.text);break;case"reasoning.encrypted":e.data&&S("[REDACTED]");break;case"reasoning.summary":e.summary&&S(e.summary)}else E.reasoning&&S(E.reasoning);if(E.content&&(f&&!g&&(t.enqueue({type:"reasoning-end",id:r||nd()}),f=!1),g||(n=o||nd(),t.enqueue({type:"text-start",id:n}),g=!0),t.enqueue({type:"text-delta",delta:E.content,id:n||nd()})),E.annotations)for(let e of E.annotations)"url_citation"===e.type&&t.enqueue({type:"source",sourceType:"url",id:e.url_citation.url,url:e.url_citation.url,title:e.url_citation.title,providerMetadata:{openrouter:{content:e.url_citation.content||""}}});if(null!=E.tool_calls)for(let e of E.tool_calls){let n=null!=(l=e.index)?l:c.length-1;if(null==c[n]){if("function"!==e.type)throw new tG({data:e,message:"Expected 'function' type."});if(null==e.id)throw new tG({data:e,message:"Expected 'id' to be a string."});if((null==(u=e.function)?void 0:u.name)==null)throw new tG({data:e,message:"Expected 'function.name' to be a string."});c[n]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(y=e.function.arguments)?y:""},inputStarted:!1,sent:!1};let r=c[n];if(null==r)throw new tG({data:{index:n,toolCallsLength:c.length},message:`Tool call at index ${n} is missing after creation.`});(null==(v=r.function)?void 0:v.name)!=null&&(null==(b=r.function)?void 0:b.arguments)!=null&&nk(r.function.arguments)&&(r.inputStarted=!0,t.enqueue({type:"tool-input-start",id:r.id,toolName:r.function.name}),t.enqueue({type:"tool-input-delta",id:r.id,delta:r.function.arguments}),t.enqueue({type:"tool-input-end",id:r.id}),t.enqueue({type:"tool-call",toolCallId:r.id,toolName:r.function.name,input:r.function.arguments}),r.sent=!0);continue}let r=c[n];if(null==r)throw new tG({data:{index:n,toolCallsLength:c.length,toolCallDelta:e},message:`Tool call at index ${n} is missing during merge.`});r.inputStarted||(r.inputStarted=!0,t.enqueue({type:"tool-input-start",id:r.id,toolName:r.function.name})),(null==(_=e.function)?void 0:_.arguments)!=null&&(r.function.arguments+=null!=(w=null==(z=e.function)?void 0:z.arguments)?w:""),t.enqueue({type:"tool-input-delta",id:r.id,delta:null!=(k=e.function.arguments)?k:""}),(null==(x=r.function)?void 0:x.name)!=null&&(null==(T=r.function)?void 0:T.arguments)!=null&&nk(r.function.arguments)&&(t.enqueue({type:"tool-call",toolCallId:null!=(j=r.id)?j:nd(),toolName:r.function.name,input:r.function.arguments}),r.sent=!0)}if(null!=E.images)for(let e of E.images)t.enqueue({type:"file",mediaType:nH(e.image_url.url,"image/jpeg"),data:nJ(e.image_url.url)})},flush(e){var t;if("tool-calls"===p)for(let n of c)n&&!n.sent&&(e.enqueue({type:"tool-call",toolCallId:null!=(t=n.id)?t:nd(),toolName:n.function.name,input:nk(n.function.arguments)?n.function.arguments:"{}"}),n.sent=!0);f&&e.enqueue({type:"reasoning-end",id:r||nd()}),g&&e.enqueue({type:"text-end",id:n||nd()});let o={usage:h};void 0!==s&&(o.provider=s),m.length>0&&(o.reasoning_details=m),e.enqueue({type:"finish",finishReason:p,usage:d,providerMetadata:{openrouter:o}})}})),warnings:[],request:{body:i},response:{headers:u}}}},n9=v.z.union([v.z.object({id:v.z.string().optional(),model:v.z.string().optional(),choices:v.z.array(v.z.object({text:v.z.string(),reasoning:v.z.string().nullish().optional(),reasoning_details:nZ.nullish(),finish_reason:v.z.string().nullish(),index:v.z.number().nullish(),logprobs:v.z.object({tokens:v.z.array(v.z.string()),token_logprobs:v.z.array(v.z.number()),top_logprobs:v.z.array(v.z.record(v.z.string(),v.z.number())).nullable()}).passthrough().nullable().optional()}).passthrough()),usage:v.z.object({prompt_tokens:v.z.number(),prompt_tokens_details:v.z.object({cached_tokens:v.z.number()}).passthrough().nullish(),completion_tokens:v.z.number(),completion_tokens_details:v.z.object({reasoning_tokens:v.z.number()}).passthrough().nullish(),total_tokens:v.z.number(),cost:v.z.number().optional()}).passthrough().nullish()}).passthrough(),nM]),n4=class{constructor(e,t,n){this.specificationVersion="v2",this.provider="openrouter",this.supportedUrls={"image/*":[/^data:image\/[a-zA-Z]+;base64,/,/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i],"text/*":[/^data:text\//,/^https?:\/\/.+$/],"application/*":[/^data:application\//,/^https?:\/\/.+$/]},this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=n}getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:r,frequencyPenalty:o,presencePenalty:s,seed:a,responseFormat:i,topK:l,stopSequences:u,tools:c,toolChoice:p}){let{prompt:d}=function({prompt:e,inputFormat:t,user:n="user",assistant:r="assistant"}){if(1===e.length&&e[0]&&"user"===e[0].role&&1===e[0].content.length&&e[0].content[0]&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let o="";for(let{role:t,content:s}of(e[0]&&"system"===e[0].role&&(o+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new tH({message:`Unexpected system message in prompt: ${s}`,prompt:e});case"user":{let e=s.map(e=>{switch(e.type){case"text":return e.text;case"file":throw new na({functionality:"file attachments"});default:return""}}).join("");o+=`${n}:
${e}

`;break}case"assistant":{let e=s.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new na({functionality:"tool-call messages"});case"tool-result":throw new na({functionality:"tool-result messages"});case"reasoning":throw new na({functionality:"reasoning messages"});case"file":throw new na({functionality:"file attachments"});default:return""}}).join("");o+=`${r}:
${e}

`;break}case"tool":throw new na({functionality:"tool messages"})}return{prompt:o+=`${r}:
`}}({prompt:e,inputFormat:"prompt"});if(null==c?void 0:c.length)throw new na({functionality:"tools"});if(p)throw new na({functionality:"toolChoice"});return tT(tT({model:this.modelId,models:this.settings.models,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:t,temperature:n,top_p:r,frequency_penalty:o,presence_penalty:s,seed:a,stop:u,response_format:i,top_k:l,prompt:d,include_reasoning:this.settings.includeReasoning,reasoning:this.settings.reasoning},this.config.extraBody),this.settings.extraBody)}async doGenerate(e){var t,n,r,o,s,a,i,l,u,c,p,d,h,m,g;let f=(e.providerOptions||{}).openrouter||{},y=tT(tT({},this.getArgs(e)),f),{value:v,responseHeaders:b}=await nT({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:nc(this.config.headers(),e.headers),body:y,failedResponseHandler:nV,successfulResponseHandler:nI(n9),abortSignal:e.abortSignal,fetch:this.config.fetch});if("error"in v){let e=v.error;throw new tO({message:e.message,url:this.config.url({path:"/completions",modelId:this.modelId}),requestBodyValues:y,statusCode:200,responseHeaders:b,data:e})}let _=v.choices[0];if(!_)throw new t7({message:"No choice in OpenRouter completion response"});return{content:[{type:"text",text:null!=(t=_.text)?t:""}],finishReason:nL(_.finish_reason),usage:{inputTokens:null!=(r=null==(n=v.usage)?void 0:n.prompt_tokens)?r:0,outputTokens:null!=(s=null==(o=v.usage)?void 0:o.completion_tokens)?s:0,totalTokens:(null!=(i=null==(a=v.usage)?void 0:a.prompt_tokens)?i:0)+(null!=(u=null==(l=v.usage)?void 0:l.completion_tokens)?u:0),reasoningTokens:null!=(d=null==(p=null==(c=v.usage)?void 0:c.completion_tokens_details)?void 0:p.reasoning_tokens)?d:0,cachedInputTokens:null!=(g=null==(m=null==(h=v.usage)?void 0:h.prompt_tokens_details)?void 0:m.cached_tokens)?g:0},warnings:[],response:{headers:b}}}async doStream(e){let t=(e.providerOptions||{}).openrouter||{},n=tT(tT({},this.getArgs(e)),t),{value:r,responseHeaders:o}=await nT({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:nc(this.config.headers(),e.headers),body:tb(tT({},n),t_({stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0})),failedResponseHandler:nV,successfulResponseHandler:nP(n9),abortSignal:e.abortSignal,fetch:this.config.fetch}),s="other",a={inputTokens:NaN,outputTokens:NaN,totalTokens:NaN,reasoningTokens:NaN,cachedInputTokens:NaN},i={};return{stream:r.pipeThrough(new TransformStream({transform(e,t){var n,r;if(!e.success){s="error",t.enqueue({type:"error",error:e.error});return}let o=e.value;if("error"in o){s="error",t.enqueue({type:"error",error:o.error});return}if(null!=o.usage){if(a.inputTokens=o.usage.prompt_tokens,a.outputTokens=o.usage.completion_tokens,a.totalTokens=o.usage.prompt_tokens+o.usage.completion_tokens,i.promptTokens=o.usage.prompt_tokens,o.usage.prompt_tokens_details){let e=null!=(n=o.usage.prompt_tokens_details.cached_tokens)?n:0;a.cachedInputTokens=e,i.promptTokensDetails={cachedTokens:e}}if(i.completionTokens=o.usage.completion_tokens,o.usage.completion_tokens_details){let e=null!=(r=o.usage.completion_tokens_details.reasoning_tokens)?r:0;a.reasoningTokens=e,i.completionTokensDetails={reasoningTokens:e}}i.cost=o.usage.cost,i.totalTokens=o.usage.total_tokens}let l=o.choices[0];(null==l?void 0:l.finish_reason)!=null&&(s=nL(l.finish_reason)),(null==l?void 0:l.text)!=null&&t.enqueue({type:"text-delta",delta:l.text,id:nd()})},flush(e){e.enqueue({type:"finish",finishReason:s,usage:a,providerMetadata:{openrouter:{usage:i}}})}})),response:{headers:o}}}};function n2(e={}){var t,n,r,o;let s=null!=(n=null==(o=null!=(t=e.baseURL)?t:e.baseUrl)?void 0:o.replace(/\/$/,""))?n:"https://openrouter.ai/api/v1",a=null!=(r=e.compatibility)?r:"compatible",i=()=>(function(e,...t){let n=Object.fromEntries(Object.entries(null!=e?e:{}).filter(([,e])=>null!==e)),r=[n["user-agent"]||"",...t].filter(Boolean).join(" ");return tb(tT({},n),t_({"user-agent":r}))})(tT({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:r}){if("string"==typeof e)return e;if(null!=e)throw new t2({message:`${r} API key must be a string.`});if("u"<typeof process)throw new t2({message:`${r} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new t2({message:`${r} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new t2({message:`${r} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENROUTER_API_KEY",description:"OpenRouter"})}`},e.headers),"ai-sdk/openrouter/1.2.3"),l=(t,n={})=>new n1(t,n,{provider:"openrouter.chat",url:({path:e})=>`${s}${e}`,headers:i,compatibility:a,fetch:e.fetch,extraBody:e.extraBody}),u=(t,n={})=>new n4(t,n,{provider:"openrouter.completion",url:({path:e})=>`${s}${e}`,headers:i,compatibility:a,fetch:e.fetch,extraBody:e.extraBody}),c=(e,t)=>{if(new.target)throw Error("The OpenRouter model function cannot be called with the new keyword.");return"openai/gpt-3.5-turbo-instruct"===e?u(e,t):l(e,t)},p=(e,t)=>c(e,t);return p.languageModel=c,p.chat=l,p.completion=u,p}function n6(e,t){if(t&&!e.startsWith(`${t}/`))throw Error(`Expected ${t}/ in model router ID ${e}`);let n=e.split("/");if("azure-openai"===t){if(n.length<2)throw Error(`Expected format azure-openai/deployment-name, but got ${e}`);return{providerId:"azure-openai",modelId:n.slice(1).join("/")}}if(t&&n.length<3)throw Error(`Expected atleast 3 id parts ${t}/provider/model, but only saw ${n.length} in ${e}`);let r=n.at(+!!t),o=n.slice(t?2:1).join("/");if(!e.includes("/")||!r||!o)throw Error(`Attempted to parse provider/model from ${e} but this ID doesn't appear to contain a provider`);return{providerId:r,modelId:o}}n2({compatibility:"strict"});var n3=["anthropic","deepseek","google","mistral","openai","openrouter","perplexity","xai"],n5=["github-copilot"],n7={cerebras:{url:"https://api.cerebras.ai/v1"},mistral:{url:"https://api.mistral.ai/v1"},groq:{url:"https://api.groq.com/openai/v1"},togetherai:{url:"https://api.together.xyz/v1"},deepinfra:{url:"https://api.deepinfra.com/v1/openai"},vercel:{url:"https://ai-gateway.vercel.sh/v1",apiKeyEnvVar:"AI_GATEWAY_API_KEY"}},n8=class extends g.MastraModelGateway{id="models.dev";name="models.dev";providerConfigs={};constructor(e){super(),e&&(this.providerConfigs=e)}async fetchProviders(){let e=await fetch("https://models.dev/api.json");if(!e.ok)throw Error(`Failed to fetch from models.dev: ${e.statusText}`);let t=await e.json(),n={};for(let[e,r]of Object.entries(t)){if(n5.includes(e)||!r||"object"!=typeof r||!r.models)continue;let t="@ai-sdk/openai-compatible"===r.npm||"@ai-sdk/gateway"===r.npm||e in n7,o=n3.includes(e),s=r.api&&r.env&&r.env.length>0;if(t||o||s){let t=Object.entries(r.models).filter(([,e])=>e?.status!=="deprecated").map(([e])=>e).sort(),s=r.api||n7[e]?.url;if(!o&&!s)continue;let a=r.env?.[0]||`${e.toUpperCase().replace(/-/g,"_")}_API_KEY`,i=o?void 0:n7[e]?.apiKeyHeader||"Authorization";n[e]={url:s,apiKeyEnvVar:a,apiKeyHeader:i,name:r.name||e.charAt(0).toUpperCase()+e.slice(1),models:t,docUrl:r.doc,gateway:"models.dev"}}}return this.providerConfigs=n,n}buildUrl(e,t){let{providerId:n}=n6(e),r=this.providerConfigs[n];if(!r?.url)return;let o=`${n.toUpperCase().replace(/-/g,"_")}_BASE_URL`;return t?.[o]||process.env[o]||r.url}getApiKey(e){let[t,n]=e.split("/");if(!t||!n)throw Error(`Could not identify provider from model id ${e}`);let r=this.providerConfigs[t];if(!r)throw Error(`Could not find config for provider ${t} with model id ${e}`);let o="string"==typeof r.apiKeyEnvVar?process.env[r.apiKeyEnvVar]:void 0;if(!o)throw Error(`Could not find API key process.env.${r.apiKeyEnvVar} for model id ${e}`);return Promise.resolve(o)}async resolveLanguageModel({modelId:e,providerId:t,apiKey:n,headers:r}){let o=this.buildUrl(`${t}/${e}`);switch(t){case"openai":return(0,g.createOpenAI)({apiKey:n}).responses(e);case"gemini":case"google":return(0,g.createGoogleGenerativeAI)({apiKey:n}).chat(e);case"anthropic":return(0,g.createAnthropic)({apiKey:n})(e);case"mistral":return eR({apiKey:n})(e);case"openrouter":return n2({apiKey:n,headers:r})(e);case"xai":return ty({apiKey:n})(e);case"deepseek":return ew({apiKey:n})(e);case"perplexity":return tt({apiKey:n})(e);default:if(!o)throw Error(`No API URL found for ${t}/${e}`);return(0,g.createOpenAICompatible)({name:t,apiKey:n,baseURL:o,supportsStructuredOutputs:!0}).chatModel(e)}}};e.s(["ModelsDevGateway",()=>n8,"parseModelRouterId",()=>n6])}];

//# sourceMappingURL=87826_%40mastra_core_dist_chunk-GVINAESE_0be956b1.js.map